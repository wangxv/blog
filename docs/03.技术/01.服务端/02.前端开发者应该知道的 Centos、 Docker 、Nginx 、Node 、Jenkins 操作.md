---
title: å‰ç«¯å¼€å‘è€…åº”è¯¥çŸ¥é“çš„ Centosã€ Docker ã€Nginx ã€Node ã€Jenkins æ“ä½œ
date: 2022-05-15 10:34:27
permalink: /pages/de6f44/
categories:
  - æŠ€æœ¯
  - æœåŠ¡ç«¯
tags:
  - 
---

# å‰ç«¯å¼€å‘è€…åº”è¯¥çŸ¥é“çš„ Centos / Docker / Nginx / Node / Jenkins æ“ä½œ

![Untitled](%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%80%85%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%20Centos%20Docker%20Nginx%20Node%20Jenkins%20%E6%93%8D%E4%BD%9C%2088481b53f8d0492ca62434a0a42a2122/Untitled.png)

æœåŠ¡å™¨ä½œä¸ºå¼€å‘çš„ä¸€ç¯ï¼Œå¹¶ä¸”ç°åœ¨éå¸¸å¤šçš„å•†ä¸šå…¬å¸éƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šçš„æœåŠ¡å™¨éƒ½æ˜¯`CentOS`ç³»ç»Ÿ! è®©æˆ‘ä»¬äº†è§£äº†è§£ä¹Ÿåœ¨æƒ…ç†ä¹‹ä¸­ï¼

ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬åº”è¯¥è·³å‡ºè‡ªå·±çš„ä¸€äº©ä¸‰åˆ†åœ°ï¼Œè·³å‡ºèˆ’é€‚åŒºã€‚æ‰©å¤§è‡ªå·±çš„æŠ€æœ¯å¹¿åº¦å’Œæ·±åº¦ï¼Œåªæœ‰è¿™æ ·!æˆ‘ä»¬æ‰èƒ½"åšå¤§åšå¼ºï¼Œå†åˆ›è¾‰ç…Œ"

æœ¬ç¯‡æ–‡ç« æ—¨åœ¨ä»‹ç»åœ¨ Centos ä¸Šçš„ä¸€äº›å¸¸è§ç¯å¢ƒé…ç½®æŠ€å·§ï¼Œä¸º"å‰ç«¯å°ç™½"ä»¬åœ¨`CentOS`çš„é“è·¯ä¸Šæ›´è¿›ä¸€æ­¥ï¼

## **Centos**

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lI6ic0Hja6GWlZgQT2kuZWYgvubsSADbApFuTWoac3U0bgO9NhQYJYZg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lI6ic0Hja6GWlZgQT2kuZWYgvubsSADbApFuTWoac3U0bgO9NhQYJYZg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

Centos æ˜¯ä¸€ä¸ªåŸºäº Linux çš„å¼€æºå…è´¹æ“ä½œç³»ç»Ÿï¼Œä¸‹é¢åˆ—å‡ºä¸€äº›å¸¸ç”¨æ“ä½œ

```
#Â æœ¬åœ°æ‹·è´æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨
scpÂ output.txtÂ root@47.93.242.155:/data/

```

- `output.txt`:æœ¬åœ°æ–‡ä»¶
- `root`:ç™»å½•è¿œç¨‹æœåŠ¡å™¨çš„è´¦å·
- `47.93.242.155`:è¿œç¨‹æœåŠ¡å™¨çš„ IP
- `/data/`:è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•

```
#Â æ‹·è´Dç›˜httpsç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åˆ°Â è¿œç¨‹çš„Â /dataÂ ç›®å½•
scpÂ D:/https/*Â root@47.93.242.155:/data

```

### **æœ¬åœ°é“¾æ¥è¿œç¨‹ Centos æœåŠ¡å™¨**

`ssh -p ç«¯å£ ç”¨æˆ·å@æœåŠ¡å™¨IP`

ä¾‹å­:

```
sshÂ -pÂ Â 22Â Â root@47.93.242.155
Â #Â è¾“å…¥ç™»å½•å¯†ç 
Â #Â æˆåŠŸ

```

### **yum åˆ‡æ¢ä¸ºé˜¿é‡Œæº**

```
cdÂ /etc/yum.repos.d/

curlÂ -oÂ /etc/yum.repos.d/CentOS-Base.repoÂ https://mirrors.aliyun.com/repo/Centos-8.repo
Â #Â é‡æ–°ç”Ÿæˆç¼“å­˜--æŸ¥çœ‹æ‰§è¡Œç»“æœï¼Œå¦‚æœæœ‰aliyunÂ å­—æ ·å°±ç®—æˆåŠŸ
yumÂ makecache

```

### **å…¶ä»–**

```
#Â åˆ›å»ºÂ /data/testÂ ç›®å½•
mkdirÂ /data/test
Â #Â åˆ›å»ºÂ /data/newtestÂ ç›®å½•
mkdirÂ /data/newtest
Â #Â åˆ›å»ºÂ /data/test/index.htmlÂ æ–‡ä»¶
touchÂ /data/test/index.html
Â #Â ç¼–è¾‘æ–‡ä»¶
viÂ /data/test/index.html
Â #Â æŸ¥çœ‹æ–‡ä»¶å†…å®¹
catÂ /data/www/index.html
Â #Â å°†Â `test`ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°Â `newtest`ç›®å½•Â ä¸‹
cpÂ â€“rÂ /data/test/*Â Â /data/newtest
Â #Â åˆ é™¤Â /data/newtest/index.htmlÂ æ–‡ä»¶
rmÂ -rfÂ /data/newtest/index.html
Â #Â å°†Â `test`ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ç›®å½•Â `newtest`ç›®å½•Â ä¸‹
mvÂ /data/test/*Â Â /data/newtest

```

```
#Â æŸ¥çœ‹å½“å‰ç›®å½•çš„è·¯å¾„
pwd

```

```
#Â æ£€æŸ¥ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨
netstatÂ -lnp|grepÂ 88Â Â Â #88è¯·æ¢ä¸ºä½ éœ€è¦çš„ç«¯å£ï¼Œå¦‚ï¼š80

```

æ‰§è¡Œ`netstat -lnp|grep ç«¯å£å·`ä¹‹åä¼šæ‰“å°å‡ºè¢«å ç”¨çš„è¿›ç¨‹åŠå…¶ç¼–å·

```
#Â æ€æ‰ç¼–å·ä¸º1777çš„è¿›ç¨‹ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µè¾“å…¥ï¼‰
killÂ -9Â 1777

```

æŸ¥çœ‹å½“å‰Â `Centos`Â æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¿¡æ¯

```
catÂ /etc/redhat-release

```

## **Nginx æœåŠ¡å™¨æ­å»º**

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2luNe3pdMqLaBnKmEeic27dDiazbibhl58P1sxwNv7DwsKAyAXvenWoOibiaw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2luNe3pdMqLaBnKmEeic27dDiazbibhl58P1sxwNv7DwsKAyAXvenWoOibiaw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† web æœåŠ¡å™¨ï¼Œä½¿ç”¨ nginx ç½‘ç«™æœ‰ï¼šç™¾åº¦ã€äº¬ä¸œã€æ–°æµªã€ç½‘æ˜“ã€è…¾è®¯ã€æ·˜å®...ã€‚

### **Centos ä¸‹å®‰è£… Nginx æœåŠ¡å™¨**

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Â `yum`Â å®‰è£… Nginx æœåŠ¡å™¨ã€‚

```
yumÂ installÂ -yÂ nginx

```

### **å¯åŠ¨ Nginx æœåŠ¡å™¨**

å®‰è£…åçš„ Nginx æ²¡æœ‰å¯åŠ¨ï¼Œå…ˆå¯åŠ¨ Nginx æœåŠ¡å™¨ã€‚

```
nginx

```

æ­¤æ—¶ï¼Œè®¿é—®Â `http://<æ‚¨çš„åŸŸåæˆ–IP>`Â å¯ä»¥çœ‹åˆ° Nginx çš„æµ‹è¯•é¡µé¢

> å¦‚æœæ— æ³•è®¿é—®ï¼Œè¯·é‡è¯•ç”¨Â nginx -s reloadÂ å‘½ä»¤é‡å¯ Nginx
> 

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxE3CUMxMCuN3DlEIj3yNiaHxykMibnqSicGBz2X0jzZ0JlDMAw1z6uRZA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxE3CUMxMCuN3DlEIj3yNiaHxykMibnqSicGBz2X0jzZ0JlDMAw1z6uRZA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **é…ç½®é™æ€æœåŠ¡å™¨è®¿é—®è·¯å¾„**

å¤–ç½‘ç”¨æˆ·è®¿é—®æœåŠ¡å™¨çš„ Web æœåŠ¡ç”±Â `Nginx`Â æä¾›ï¼Œ`Nginx`Â éœ€è¦é…ç½®é™æ€èµ„æºçš„è·¯å¾„ä¿¡æ¯æ‰èƒ½é€šè¿‡Â `url`Â æ­£ç¡®è®¿é—®åˆ°æœåŠ¡å™¨ä¸Šçš„é™æ€èµ„æºã€‚

æ‰“å¼€Â `Nginx`Â çš„é»˜è®¤é…ç½®æ–‡ä»¶Â `/etc/nginx/nginx.conf`Â ï¼Œä¿®æ”¹ Nginx é…ç½®

```
viÂ /etc/nginx/nginx.conf

```

å°†é»˜è®¤çš„Â `/usr/share/nginx/html`; ä¿®æ”¹ä¸º:Â `/data/www`;ï¼Œå¦‚ä¸‹ï¼š

ç¤ºä¾‹ä»£ç ï¼š`/etc/nginx/nginx.conf`

```
userÂ nginx;
worker_processesÂ auto;
error_logÂ /var/log/nginx/error.log;
pidÂ /run/nginx.pid;

includeÂ /usr/share/nginx/modules/*.conf;

eventsÂ {
Â Â Â Â worker_connectionsÂ 1024;
}

httpÂ {
Â Â Â Â log_formatÂ Â mainÂ Â '$remote_addrÂ -Â $remote_userÂ [$time_local]Â "$request"Â '
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â '$statusÂ $body_bytes_sentÂ "$http_referer"Â '
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â '"$http_user_agent"Â "$http_x_forwarded_for"';

Â Â Â Â access_logÂ Â /var/log/nginx/access.logÂ Â main;

Â Â Â Â sendfileÂ Â Â Â Â Â Â Â Â Â Â Â on;
Â Â Â Â tcp_nopushÂ Â Â Â Â Â Â Â Â Â on;
Â Â Â Â tcp_nodelayÂ Â Â Â Â Â Â Â Â on;
Â Â Â Â keepalive_timeoutÂ Â Â 65;
Â Â Â Â types_hash_max_sizeÂ 2048;

Â Â Â Â includeÂ Â Â Â Â Â Â Â Â Â Â Â Â /etc/nginx/mime.types;
Â Â Â Â default_typeÂ Â Â Â Â Â Â Â application/octet-stream;

Â Â Â Â includeÂ /etc/nginx/conf.d/*.conf;

Â Â Â Â serverÂ {
Â Â Â Â Â Â Â Â listenÂ Â Â Â Â Â Â 80Â default_server;
Â Â Â Â Â Â Â Â listenÂ Â Â Â Â Â Â [::]:80Â default_server;
Â Â Â Â Â Â Â Â server_nameÂ Â _;
Â Â Â Â Â Â Â Â #Â ä¿®æ”¹ä¸ºä»¥ä¸‹è·¯å¾„
Â Â Â Â Â Â Â Â rootÂ Â Â Â Â Â Â Â Â /data/www;

Â Â Â Â Â Â Â Â includeÂ /etc/nginx/default.d/*.conf;

Â Â Â Â Â Â Â Â locationÂ /Â {
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â error_pageÂ 404Â /404.html;
Â Â Â Â Â Â Â Â Â Â Â Â locationÂ =Â /40x.htmlÂ {
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â error_pageÂ 500Â 502Â 503Â 504Â /50x.html;
Â Â Â Â Â Â Â Â Â Â Â Â locationÂ =Â /50x.htmlÂ {
Â Â Â Â Â Â Â Â }
Â Â Â Â }

}

```

é…ç½®æ–‡ä»¶å°†Â `/data/www/static`Â ä½œä¸ºæ‰€æœ‰é™æ€èµ„æºè¯·æ±‚çš„æ ¹è·¯å¾„ï¼Œå¦‚è®¿é—®:Â `http://<æ‚¨çš„åŸŸåæˆ–IP>/static/index.js`ï¼Œå°†ä¼šå»Â `/data/www/static/`Â ç›®å½•ä¸‹å»æŸ¥æ‰¾Â `index.js/index.html`ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦é‡å¯ Nginx è®©æ–°çš„é…ç½®ç”Ÿæ•ˆï¼Œå¦‚ï¼š

```
nginxÂ -sÂ reload

```

### **åˆ›å»ºç¬¬ä¸€ä¸ªé™æ€æ–‡ä»¶**

ç°åœ¨è®©æˆ‘ä»¬æ–°å»ºä¸€ä¸ªé™æ€æ–‡ä»¶ï¼ŒæŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œæ­£å¸¸ã€‚

é¦–å…ˆè®©æˆ‘ä»¬åœ¨Â `/data`Â ç›®å½• ä¸‹åˆ›å»ºÂ `www`Â ç›®å½•ï¼Œå¦‚ï¼š

```
mkdirÂ -pÂ /data/www

```

åœ¨Â `/data/www`Â ç›®å½•ä¸‹åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªé™æ€æ–‡ä»¶Â `index.html`

```
touchÂ /data/www/index.html

viÂ /data/www/index.html

```

ç¤ºä¾‹ä»£ç ï¼š`/data/www/index.html`

```
<!DOCTYPEÂ html>
<htmlÂ lang="zh">
Â Â <head>
Â Â Â Â <metaÂ charset="UTF-8"Â />
Â Â Â Â <title>ç¬¬ä¸€ä¸ªé™æ€æ–‡ä»¶</title>
Â Â </head>
Â Â <body>
Â Â Â Â <h1>Hello worldï¼</h1>
Â Â </body>
</html>

```

ç°åœ¨è®¿é—®Â `http://<æ‚¨çš„åŸŸåæˆ–IP>/index.html`Â åº”è¯¥å¯ä»¥çœ‹åˆ°é¡µé¢è¾“å‡ºÂ `Hello world!`

åˆ°æ­¤ï¼Œä¸€ä¸ªåŸºäº Nginx çš„é™æ€æœåŠ¡å™¨å°±æ­å»ºå®Œæˆäº†ï¼Œç°åœ¨æ‰€æœ‰æ”¾åœ¨Â `/data/www`Â ç›®å½•ä¸‹çš„çš„é™æ€èµ„æºéƒ½å¯ä»¥ç›´æ¥é€šè¿‡åŸŸå/IP è®¿é—®ã€‚

> å¦‚æœæ— æ˜¾ç¤ºï¼Œè¯·åˆ·æ–°æµè§ˆå™¨é¡µé¢
> 

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l75jaAXde1tJU3MTXYfW9p5hLAPsribF5cLMFR7D9seqr72RGmX8zictQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l75jaAXde1tJU3MTXYfW9p5hLAPsribF5cLMFR7D9seqr72RGmX8zictQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **Nginx é…ç½® SSL æ³›åŸŸåè¯ä¹¦**

è¿™é‡Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„å…è´¹è¯ä¹¦ï¼ŒæœŸé™ä¸º 1 å¹´

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lAk6Wtdh6s0CtQOfHmtnBnVJlMib72UKOa81xIzJd9H93Fs5U5Kp07Fw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lAk6Wtdh6s0CtQOfHmtnBnVJlMib72UKOa81xIzJd9H93Fs5U5Kp07Fw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

è´­ä¹°æˆåŠŸåè¿›å…¥`sslè¯ä¹¦æ§åˆ¶å°`Â ä¸‹è½½è¯ä¹¦

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxHuibFlVyaeD0GrYJDicFJtjQAk3NqK1lhmtIjmQoZuiaL6m0uTOKu8qQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxHuibFlVyaeD0GrYJDicFJtjQAk3NqK1lhmtIjmQoZuiaL6m0uTOKu8qQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

ä¸‹è½½ç”³è¯·å¥½çš„ ssl è¯ä¹¦æ–‡ä»¶å‹ç¼©åŒ…åˆ°æœ¬åœ°å¹¶è§£å‹æ”¾åˆ°è‡ªå·±å–œæ¬¢çš„ç›®å½•,å¦‚`D:/https/`ã€‚(è¿™é‡Œæ˜¯ç”¨çš„ pem ä¸ key æ–‡ä»¶ï¼Œæ–‡ä»¶åå¯ä»¥æ›´æ”¹)ã€‚

åœ¨è¿æ¥æœåŠ¡å™¨çš„çª—å£ä¸­åˆ›å»ºÂ `/data/cert`Â ç›®å½•ç”¨æ¥å­˜æ”¾è¯ä¹¦æ–‡ä»¶

```
mkdirÂ /data/cert

```

ä½¿ç”¨Â `scp`Â å‘½ä»¤ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨(è¿™é‡Œéœ€è¦æ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œä¸è¦ä½¿ç”¨è¿æ¥æœåŠ¡å™¨çš„çª—å£):

```
scpÂ D:/https/*Â root@47.93.242.155:/data/cert

```

ä¸Šé¢çš„æ„æ€æ˜¯æ‹·è´`D:/https/`ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨çš„Â `/data/cert`ç›®å½•ä¸­

- `D:/https/`:æœ¬åœ°æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
- `root`:é€šè¿‡ root ç”¨æˆ·ç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨
- `47.93.242.155`:è¿œç¨‹æœåŠ¡å™¨çš„ ip åœ°å€
- `/data/cert`:è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„è·¯å¾„

### **å¼€å¯ 443 ç›‘å¬**

Nginx å¯åŠ¨åé»˜è®¤åªç›‘å¬ 80 ç«¯å£ã€‚

è¿™é‡Œæˆ‘ä»¬æŠŠ 443 ç«¯å£çš„ç›‘å¬ä¹Ÿä¸€å¹¶å¼€å¯ã€‚

ç¼–è¾‘å…¨å±€é…ç½®æ–‡ä»¶

```
viÂ /etc/nginx/nginx.conf

```

ç¤ºä¾‹ä»£ç ï¼š`/etc/nginx/nginx.conf`,**è¯´æ˜éƒ½åœ¨æ³¨é‡Šä¸­**

```
#Â ForÂ moreÂ informationÂ onÂ configuration,Â see:
#Â Â Â *Â OfficialÂ EnglishÂ Documentation:Â http://nginx.org/en/docs/
#Â Â Â *Â OfficialÂ RussianÂ Documentation:Â http://nginx.org/ru/docs/

userÂ nginx;
worker_processesÂ auto;
error_logÂ /var/log/nginx/error.log;
pidÂ /run/nginx.pid;

#Â LoadÂ dynamicÂ modules.Â SeeÂ /usr/share/nginx/README.dynamic.
includeÂ /usr/share/nginx/modules/*.conf;

eventsÂ {
Â Â Â Â worker_connectionsÂ 1024;
}

httpÂ {
Â Â Â Â log_formatÂ Â mainÂ Â '$remote_addrÂ -Â $remote_userÂ [$time_local]Â "$request"Â '
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â '$statusÂ $body_bytes_sentÂ "$http_referer"Â '
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â '"$http_user_agent"Â "$http_x_forwarded_for"';

Â Â Â Â access_logÂ Â /var/log/nginx/access.logÂ Â main;

Â Â Â Â sendfileÂ Â Â Â Â Â Â Â Â Â Â Â on;
Â Â Â Â tcp_nopushÂ Â Â Â Â Â Â Â Â Â on;
Â Â Â Â tcp_nodelayÂ Â Â Â Â Â Â Â Â on;
Â Â Â Â keepalive_timeoutÂ Â Â 65;
Â Â Â Â types_hash_max_sizeÂ 2048;

Â Â Â Â includeÂ Â Â Â Â Â Â Â Â Â Â Â Â /etc/nginx/mime.types;
Â Â Â Â default_typeÂ Â Â Â Â Â Â Â application/octet-stream;

Â Â Â Â #Â LoadÂ modularÂ configurationÂ filesÂ fromÂ theÂ /etc/nginx/conf.dÂ directory.
Â Â Â Â #Â SeeÂ http://nginx.org/en/docs/ngx_core_module.html#include
Â Â Â Â #Â forÂ moreÂ information.
Â Â Â Â includeÂ /etc/nginx/conf.d/*.conf;

Â Â Â Â serverÂ {
Â Â Â Â Â Â Â Â listenÂ Â Â Â Â Â Â 80;
Â Â Â Â Â Â Â Â #Â ä¿®æ”¹åŸŸå
Â Â Â Â Â Â Â Â server_nameÂ Â nsuedu.cn;

Â Â Â Â Â Â Â Â #Â å¦‚æœæ˜¯HTTPè¯·æ±‚åˆ™é‡å®šå‘åˆ°HTTPS
Â Â Â Â Â Â Â Â rewriteÂ ^(.*)Â https://$host$1Â permanent;
Â Â Â Â }

#Â SettingsÂ forÂ aÂ TLSÂ enabledÂ server.

Â Â Â Â serverÂ {
Â Â Â Â Â Â Â Â Â #Â æœåŠ¡å™¨ç«¯å£ä½¿ç”¨443ï¼Œå¼€å¯ssl
Â Â Â Â Â Â Â Â listenÂ Â Â Â Â Â Â 443Â sslÂ http2Â default_server;
Â Â Â Â Â Â Â Â listenÂ Â Â Â Â Â Â [::]:443Â sslÂ http2Â default_server;

Â Â Â Â Â Â Â Â #Â è¾“å…¥ä½ çš„åŸŸå
Â Â Â Â Â Â Â Â server_nameÂ Â nsuedu.cn;

Â Â Â Â Â Â Â Â #Â ä¿®æ”¹é™æ€æ–‡ä»¶çš„è·¯å¾„
Â Â Â Â Â Â Â Â rootÂ Â Â Â Â Â Â Â Â /data/www;

Â Â Â Â Â Â Â Â #Â sslè¯ä¹¦é…ç½®

Â Â Â Â Â Â Â Â #Â ä¿®æ”¹è¯ä¹¦è·¯å¾„ä¸€
Â Â Â Â Â Â Â Â ssl_certificateÂ "/data/cert/4726867_www.nsuedu.cn.pem";
Â Â Â Â Â Â Â Â #Â ä¿®æ”¹è¯ä¹¦è·¯å¾„äºŒ
Â Â Â Â Â Â Â Â ssl_certificate_keyÂ "/data/cert/4726867_www.nsuedu.cn.key";

Â Â Â Â Â Â Â Â ssl_session_cacheÂ shared:SSL:1m;
Â Â Â Â Â Â Â Â ssl_session_timeoutÂ Â 10m;Â Â #ç¼“å­˜æœ‰æ•ˆæœŸ
Â Â Â Â Â Â Â Â ssl_ciphersÂ HIGH:!aNULL:!MD5;Â Â #åŠ å¯†ç®—æ³•
Â Â Â Â Â Â Â Â ssl_prefer_server_ciphersÂ on;Â Â #ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„é¦–é€‰ç®—æ³•

Â Â Â Â Â Â Â Â #Â LoadÂ configurationÂ filesÂ forÂ theÂ defaultÂ serverÂ block.
Â Â Â Â Â Â Â Â includeÂ /etc/nginx/default.d/*.conf;

Â Â Â Â Â Â Â Â locationÂ /Â {
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â error_pageÂ 404Â /404.html;
Â Â Â Â Â Â Â Â Â Â Â Â locationÂ =Â /40x.htmlÂ {
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â error_pageÂ 500Â 502Â 503Â 504Â /50x.html;
Â Â Â Â Â Â Â Â Â Â Â Â locationÂ =Â /50x.htmlÂ {
Â Â Â Â Â Â Â Â }
Â Â Â Â }

}

```

é‡å¯ nginx

```
nginxÂ -sÂ reload

```

åœ¨æµè§ˆå™¨ä¸­è®¿é—®`http://nsuedu.cn/`

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lIYQc6ykoO84NniaSXHmSEOqcsD0gonpvjeXicAxO9GdmAiacEYoHglzIw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lIYQc6ykoO84NniaSXHmSEOqcsD0gonpvjeXicAxO9GdmAiacEYoHglzIw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **é…ç½® Nginx åå‘ä»£ç†**

å®¢æˆ·ç«¯å¯¹ä»£ç†æœåŠ¡å™¨æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦åšä»»ä½•é…ç½®ï¼Œç”¨æˆ·åªè¯·æ±‚åå‘ä»£ç†æœåŠ¡å™¨ï¼Œåå‘ä»£ç†æœåŠ¡å™¨é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨ï¼Œè·å–æ•°æ®åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

åå‘ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨å¯¹å¤–è€Œè¨€å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œåªæ˜¯æš´éœ²çš„æ˜¯ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œè€Œéšè—äº†çœŸå®æœåŠ¡å™¨çš„ IP åœ°å€ã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxadcZ70jWJF3umcEibuBzH7ribmsezR0p6CnEJvI5ianX02kKv5QlGKSw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxadcZ70jWJF3umcEibuBzH7ribmsezR0p6CnEJvI5ianX02kKv5QlGKSw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

> å‚è€ƒä»åŸç†åˆ°å®æˆ˜ï¼Œå½»åº•ææ‡‚ Nginxï¼[1]
> 

è®¿é—®è·¯å¾„:`/api/getUser`

1. å½“ nginx é…ç½®æ–‡ä»¶Â `proxy_pass`Â çš„Â **url æœ«å°¾ å¸¦`/`æ—¶**:

```
serverÂ {
Â Â Â Â Â Â Â Â listenÂ Â Â Â Â Â Â 80;
Â Â Â Â Â Â Â Â server_nameÂ Â www.123.com;

Â Â Â Â Â Â Â Â locationÂ /api/Â {
Â Â Â Â Â Â Â Â proxy_passÂ http://127.0.0.1:18081/;
Â Â Â Â Â Â Â Â }
Â Â Â Â }

```

ä»£ç†åˆ°åç«¯çš„è·¯å¾„ä¸ºï¼š`http://127.0.0.1:18081/getUser`ï¼Œçœç•¥äº†åŒ¹é…åˆ°çš„`/api/`è·¯å¾„ï¼›

1. å½“ nginx é…ç½®æ–‡ä»¶Â `proxy_pass`Â çš„Â **url æœ«å°¾ ä¸å¸¦`/`æ—¶**ï¼š

```
serverÂ {
Â Â Â Â Â Â Â Â listenÂ Â Â Â Â Â Â 80;
Â Â Â Â Â Â Â Â server_nameÂ Â www.123.com;

Â Â Â Â Â Â Â Â locationÂ /api/Â {
Â Â Â Â Â Â Â Â proxy_passÂ http://127.0.0.1:18081;
Â Â Â Â Â Â Â Â }
Â Â Â Â }

```

ä»£ç†åˆ°åç«¯çš„è·¯å¾„ä¸ºï¼š`http://127.0.0.1:18081/api/getUser`ï¼Œè¿åŒåŒ¹é…åˆ°çš„`/api/`è·¯å¾„ï¼Œä¸€èµ·è¿›è¡Œåå‘ä»£ç†ï¼›

## **Centos ä¸‹æ­å»º Node.js ç¯å¢ƒ**

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lLbSV9PTk4ia5avw3OlVdDJ9GicquXcHt4zVo009nXQSVF7fBdDmQWGFA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lLbSV9PTk4ia5avw3OlVdDJ9GicquXcHt4zVo009nXQSVF7fBdDmQWGFA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

`Node.js`Â æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„Â `JavaScript`, æ˜¯åŸºäºÂ `Chrome JavaScript V8`Â å¼•æ“å»ºç«‹çš„å¹³å°ã€‚

å®‰è£… Node.js çš„å‡ ç§æ–¹å¼

1. æ–¹æ³•ä¸€ï¼šä»`EPELåº“`å®‰è£…`Node.js`-`yum install nodejs`ï¼Œ**ä¸è¶³**:å®‰è£…çš„`node/npm`ç‰ˆæœ¬è¾ƒä½,éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ç‰ˆæœ¬
2. æ–¹æ³•äºŒ:ä½¿ç”¨å®˜æ–¹ç¼–è¯‘è¿‡çš„äºŒè¿›åˆ¶æ•°æ®åŒ…å®‰è£…,**ä¸è¶³**:å®‰è£…æ­¥éª¤ç¹æ‚
3. æ–¹æ³•ä¸‰: é€šè¿‡`NVM`å®‰è£…,æ–¹ä¾¿å¿«æ·**ä¸è¶³**:å®‰è£…æ—¶å›½å¤–çš„ç½‘ä¸å¥½ ğŸ¥¶
4. æ–¹æ³•å››:æºç ä¸‹è½½åç¼–è¯‘å®‰è£…,ç‰ˆæœ¬æ˜¯æœ€æ–°çš„

### **yum install nodejs æ–¹å¼å®‰è£…**

æŸ¥çœ‹å½“å‰ç³»ç»Ÿè‡ªå¸¦äº†å“ªäº›`nodejs`çš„ç‰ˆæœ¬

```
sudoÂ dnfÂ moduleÂ listÂ nodejs

```

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lq3zHt2DXZkxzRxxg172xfg5paPh6LDMGG2w41qv14OmbaDK1h41yeA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lq3zHt2DXZkxzRxxg172xfg5paPh6LDMGG2w41qv14OmbaDK1h41yeA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªç‰ˆæœ¬çš„Â `Node`:`10`,`12`,`14`. åœ¨ç‰ˆæœ¬ 10 ä¸Šæœ‰ä¸ª`[d]`ç¬¦å·,å®ƒä»£è¡¨ç³»ç»Ÿå°†ä¼šé»˜è®¤å®‰è£…çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ æƒ³è¦åˆ‡æ¢é»˜è®¤å®‰è£…çš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤

```
sudoÂ dnfÂ moduleÂ enableÂ nodejs:14

```

å®‰è£… Node

```
sudoÂ dnfÂ installÂ nodejs

```

æŸ¥çœ‹ node ç‰ˆæœ¬ï¼Œå¯ä»¥å‘ç°æ˜¯`Node14`çš„ç‰ˆæœ¬

```
nodeÂ --v

```

### **NVM æ–¹å¼å®‰è£…**

æˆ‘ä»¬å¯èƒ½åŒæ—¶åœ¨è¿›è¡Œ 2 ä¸ªé¡¹ç›®ï¼Œè€Œ 2 ä¸ªä¸åŒçš„é¡¹ç›®æ‰€ä½¿ç”¨çš„ node ç‰ˆæœ¬åˆæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¹äºç»´æŠ¤å¤šä¸ªç‰ˆæœ¬çš„`node`å°†ä¼šæ˜¯ä¸€ä»¶éå¸¸éº»çƒ¦çš„äº‹æƒ…ï¼Œè€Œ`nvm`å°±æ˜¯ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œäº§ç”Ÿçš„ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿çš„**åœ¨åŒä¸€å°è®¾å¤‡ä¸Šè¿›è¡Œå¤šä¸ª`node`ç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢**

> æ³¨: ä½¿ç”¨æ­¤æ–¹å¼ï¼Œåœ¨åé¢çš„ Jenkins è„šæœ¬ä½¿ç”¨ npm/yarn ä¼šæç¤ºæ‰¾ä¸åˆ°å‘½ä»¤ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å’‹è§£å†³ï¼Œæ±‚å¤§ä½¬ç§‘æ™® ğŸ¤ª
> 

ä¸‹é¢æ˜¯(2021/04)çš„æœ€æ–°ç¨³å®šç‰ˆ: å¯ä»¥åœ¨å»**NVM å®˜ç½‘[2]**çœ‹ä¸€ä¸‹ï¼Œæ›¿æ¢æˆæœ€æ–°çš„é“¾æ¥

```
curlÂ -o-Â https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.shÂ |Â cp

```

è¿˜éœ€è¦è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä»¥ç¡®è®¤ä¸Šä¸€æ¡å‘½ä»¤çš„æ›´æ”¹ç»“æœ

```
sourceÂ ~/.bash_profile

```

æŸ¥çœ‹ Node ç‰ˆæœ¬åˆ—è¡¨

```
nvmÂ list-remote

```

å®‰è£…ä¸€ä¸ªé•¿æœŸæ”¯æŒçš„ç‰ˆæœ¬

```
nvmÂ installÂ 14.16.1

```

ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ

```
nvmÂ current

nodeÂ -v

npmÂ -v

```

é€šè¿‡ ç¯å¢ƒå˜é‡`echo $PATH`Â æŸ¥çœ‹å®‰è£…çš„ä½ç½®

```
Â echoÂ $PATH
Â #Â æ‰“å°å‡ºçš„ç»“æœä¸­ï¼Œéœ€è¦å–å‡ºÂ `/root/.nvm/versions/node/v14.16.1/bin`

```

### **ä½¿ç”¨å®˜æ–¹ç¼–è¯‘è¿‡çš„äºŒè¿›åˆ¶æ•°æ®åŒ…çš„æ–¹å¼å®‰è£…**

> æ³¨: ä½¿ç”¨æ­¤æ–¹å¼ï¼Œåœ¨åé¢çš„ Jenkins è„šæœ¬ä½¿ç”¨ npm/yarn èƒ½å¤Ÿæ­£å¸¸è¿è¡Œ
> 

ä¸‹é¢æ˜¯(2021/04)çš„æœ€æ–°ç¨³å®šç‰ˆ: å¯ä»¥åœ¨å»**Node.js å®˜ç½‘[3]**çœ‹ä¸€ä¸‹ï¼Œæ›¿æ¢æˆæœ€æ–°çš„é“¾æ¥

ä¸‹è½½Â `14.16.0`Â åˆ°`/data`Â ç›®å½•

```
cdÂ /data

wgetÂ https://nodejs.org/dist/v14.16.0/node-v14.16.0-linux-x64.tar.xz

```

ä¸‹è½½å®Œæˆå, å°†å…¶è§£å‹

```
tarÂ xvJfÂ node-v14.16.0-linux-x64.tar.xz

```

å°†è§£å‹çš„Â `Node.js`Â ç›®å½•ç§»åŠ¨åˆ°Â `/usr/local`Â ç›®å½•ä¸‹

```
mvÂ node-v14.16.0-linux-x64Â /usr/local/node-v14

```

é…ç½®Â `node`Â è½¯é“¾æ¥åˆ°Â `/bin`Â ç›®å½•

```
lnÂ -sÂ /usr/local/node-v14/bin/nodeÂ /bin/node

```

### **é…ç½®å’Œä½¿ç”¨ npm**

`npm`Â æ˜¯Â `Node.js`Â çš„åŒ…ç®¡ç†å’Œåˆ†å‘å·¥å…·ã€‚å®ƒå¯ä»¥è®©Â `Node.js`Â å¼€å‘è€…èƒ½å¤Ÿæ›´åŠ è½»æ¾çš„å…±äº«ä»£ç å’Œå…±ç”¨ä»£ç ç‰‡æ®µ

ä¸‹è½½Â `node`Â çš„å‹ç¼©åŒ…ä¸­å·²ç»åŒ…å«äº†Â `npm`Â , æˆ‘ä»¬åªéœ€è¦å°†å…¶è½¯é“¾æ¥åˆ°Â `bin`Â ç›®å½•ä¸‹å³å¯

```
lnÂ -sÂ /usr/local/node-v14/bin/npmÂ /bin/npm

```

### **é…ç½®ç¯å¢ƒå˜é‡**

å°†Â `/usr/local/node-v14/bin`Â ç›®å½•æ·»åŠ åˆ°Â `$PATH`Â ç¯å¢ƒå˜é‡ä¸­å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨é€šè¿‡Â `npm`Â å…¨å±€å®‰è£…çš„ç¬¬ä¸‰æ–¹å·¥å…·

```
echoÂ 'exportÂ PATH=/usr/local/node-v14/bin:$PATH'Â >>Â /etc/profile

```

ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ

```
sourceÂ /etc/profile

```

### **ä½¿ç”¨ npm**

é€šè¿‡Â `npm`Â é…ç½®æ·˜å®æº

```
npmÂ configÂ setÂ registryÂ https://registry.npm.taobao.org

npmÂ getÂ registry

```

å…¨å±€å®‰è£…`yarn`å¹¶é…ç½®æ·˜å®æº

```
npmÂ installÂ yarnÂ -g

yarnÂ configÂ setÂ registryÂ http://registry.npm.taobao.org/

yarnÂ configÂ getÂ registry

```

## **åœ¨ Centos ä¸Šå®‰è£… Docker**

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lltBJA4XTjLgtehjmx7vCYV6BCX6YBZXjLzGiasMnuC6E4r8G5S7KickA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lltBJA4XTjLgtehjmx7vCYV6BCX6YBZXjLzGiasMnuC6E4r8G5S7KickA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æˆ– Windows æœºå™¨ä¸Š

### **Docker ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«**

- Docker æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒåŸºäº Linux å†…æ ¸å®ç°
- Docker ä½“ç§¯æ›´å°:å®¹å™¨è¿è¡Œçš„æ˜¯ä¸å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼ˆå°½ç®¡å®ƒä»¬å¯ä»¥ï¼‰ï¼Œè™šæ‹Ÿæœºå¿…é¡»è¿è¡Œå®Œæ•´çš„æ“ä½œç³»ç»Ÿ
- Docker å¯åŠ¨é€Ÿåº¦æ›´å¿«:è™šæ‹Ÿæœºå¯åŠ¨éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œ Docker å®¹å™¨å¯ä»¥åœ¨æ•°æ¯«ç§’å†…å¯åŠ¨
- ç”¨é€”/ä½œç”¨
    - è™šæ‹Ÿæœºæ›´æ“…é•¿äº**å½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒ**,è™šæ‹Ÿæœºæ›´æ“…é•¿äºå½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œäº‘æœåŠ¡æä¾›å•†é€šå¸¸é‡‡ç”¨è™šæ‹ŸæœºæŠ€æœ¯éš”ç¦»ä¸åŒçš„ç”¨æˆ·ã€‚
    - Docker é€šå¸¸ç”¨äº**éš”ç¦»ä¸åŒçš„åº”ç”¨**ï¼Œä¾‹å¦‚å‰ç«¯ï¼Œåç«¯ä»¥åŠæ•°æ®åº“ã€‚
- æ¯”å–»
    - æ‹¥æœ‰å®Œå…¨ç‹¬ç«‹ï¼ˆéš”ç¦»ï¼‰çš„ç©ºé—´;
    - å±äºä¸åŒçš„å®¢æˆ·(è™šæ‹Ÿæœºæ‰€æœ‰è€…);
    - æ¯ä¸ªä»“åº“æœ‰å„è‡ªçš„åº“ç®¡äººå‘˜ï¼ˆå½“å‰è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼‰ï¼Œæ— æ³•ç®¡ç†å…¶å®ƒä»“åº“ã€‚ä¸å­˜åœ¨ä¿¡æ¯å…±äº«çš„æƒ…å†µ
    - Docker æ¯”ä½œé›†è£…ç®±ï¼šå„ç§è´§ç‰©çš„æ‰“åŒ…(å°†å„ç§åº”ç”¨ç¨‹åºå’Œä»–ä»¬æ‰€ä¾èµ–çš„è¿è¡Œç¯å¢ƒæ‰“åŒ…æˆæ ‡å‡†çš„å®¹å™¨,å®¹å™¨ä¹‹é—´éš”ç¦»)
    - æœåŠ¡å™¨è™šæ‹ŸåŒ–å°±å¥½æ¯”åœ¨ç å¤´ä¸Šï¼ˆç‰©ç†ä¸»æœºåŠè™šæ‹ŸåŒ–å±‚ï¼‰ï¼Œå»ºç«‹äº†**å¤šä¸ªç‹¬ç«‹çš„â€œå°ç å¤´â€â€”ä»“åº“ï¼ˆè™šæ‹Ÿæœºï¼‰**
    

### **å®‰è£…ä¸é…ç½® Docker**

åœ¨å¼€å§‹å®‰è£…ä¹‹å‰ï¼Œéœ€è¦å®‰è£…Â `device-mapper-persistent-data`Â å’ŒÂ `lvm2`Â ä¸¤ä¸ªä¾èµ–ã€‚

- `device-mapper-persistent-data`Â æ˜¯Â `Linux`Â ä¸‹çš„ä¸€ä¸ªå­˜å‚¨é©±åŠ¨ï¼ŒÂ `Linux`Â ä¸Šçš„é«˜çº§å­˜å‚¨æŠ€æœ¯ã€‚
- `Lvm`çš„ä½œç”¨åˆ™æ˜¯åˆ›å»ºé€»è¾‘ç£ç›˜åˆ†åŒºã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Â `CentOS`Â çš„Â `Yum`Â åŒ…ç®¡ç†å™¨å®‰è£…ä¸¤ä¸ªä¾èµ–ï¼š

```
yumÂ installÂ -yÂ yum-utilsÂ device-mapper-persistent-dataÂ lvm2

```

ä¾èµ–å®‰è£…å®Œæ¯•åï¼Œæˆ‘ä»¬å°†é˜¿é‡Œäº‘çš„Â `Docker`Â é•œåƒæºæ·»åŠ è¿›å»ã€‚å¯ä»¥åŠ é€ŸÂ `Docker`Â çš„å®‰è£…ã€‚

```
sudoÂ yum-config-managerÂ --add-repoÂ http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

```

```
yumÂ installÂ docker-ceÂ -y

```

å®‰è£…å®Œæ¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Â `systemctl`Â å¯åŠ¨æ¥å¯åŠ¨Â `Docker`Â äº†ã€‚`systemctl`Â æ˜¯Â `Linux`çš„è¿›ç¨‹ç®¡ç†æœåŠ¡å‘½ä»¤ï¼Œä»–å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯åŠ¨Â `docker`

```
systemctlÂ startÂ docker

systemctlÂ enableÂ docker

```

æ¥ç€æ‰§è¡Œä¸€ä¸‹Â `docker -v`ï¼Œè¿™æ¡å‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥çœ‹Â `Docker`Â å®‰è£…çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹Â `docker`Â å®‰è£…çŠ¶æ€ã€‚å¦‚æœæ­£å¸¸å±•ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œä»£è¡¨Â `Docker`Â å·²ç»å®‰è£…æˆåŠŸã€‚

```
dockerÂ -v

```

è®¾ç½®å¼€æœºå¯åŠ¨

```
chkconfigÂ dockerÂ on

```

### **å…¶ä»–**

æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨

```
dockerÂ ps

```

**æ˜¾ç¤ºæœ¬åœ°é•œåƒåˆ—è¡¨[4]**

```
dockerÂ images

```

**åˆ é™¤æœ¬åœ°ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ[5]**

```
dockerÂ rmiÂ imageID

```

**å®¹å™¨çš„å¯åŠ¨/å…³é—­/é‡å¯[6]**

```
dockerÂ stopÂ containerID

dockerÂ startÂ containerID

dockerÂ restartÂ Â containerID

```

**åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨[7]**

```
dockerÂ rmÂ containerID

```

### **é…ç½®é˜¿é‡Œäº‘é•œåƒæº**

åœ¨Â `Docker`Â å®‰è£…å®Œæ¯•åï¼Œä¹‹åæˆ‘ä»¬å»æ‹‰å–Â `docker`Â é•œåƒæ—¶ï¼Œä¸€èˆ¬é»˜è®¤ä¼šå»Â `docker`Â å®˜æ–¹æºæ‹‰å–é•œåƒã€‚ä½†æ˜¯å›½å†…å‡ºæµ·ç½‘é€Ÿå®åœ¨æ˜¯å¤ªæ…¢ï¼Œæ‰€ä»¥é€‰æ‹©æˆ‘ä»¬æ›´æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒä»“åº“æºè¿›è¡Œé•œåƒä¸‹è½½åŠ é€Ÿã€‚

ç™»å½•é˜¿é‡Œäº‘å®˜ç½‘ï¼Œæ‰“å¼€Â **é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡[8]**ã€‚ç‚¹å‡»å·¦ä¾§èœå•æœ€ä¸‹é¢çš„`é•œåƒåŠ é€Ÿå™¨`Â ï¼Œé€‰æ‹©Â `CentOS`Â ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚æŒ‰ç…§å®˜ç½‘çš„æç¤ºæ‰§è¡Œå‘½ä»¤ï¼Œå³å¯æ›´æ¢Â `docker`Â é•œåƒæºåœ°å€ã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lRkbUwn5aICzI0dlmKBkTaicXWTsjzUTlMegSdvVfjozhok7P33pF8ow/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lRkbUwn5aICzI0dlmKBkTaicXWTsjzUTlMegSdvVfjozhok7P33pF8ow/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **Docker å†…é…ç½® Nginx æ–¹å¼ä¸€(æ¨è)**

å‚è€ƒÂ **Nginx å®¹å™¨æ•™ç¨‹[9]**

```
dockerÂ containerÂ runÂ -dÂ -pÂ 4030:80Â --rmÂ --nameÂ mynginxÂ nginx

```

ä¸Šé¢å‘½ä»¤çš„å„ä¸ªå‚æ•°å«ä¹‰å¦‚ä¸‹ã€‚

- `d`ï¼šåœ¨åå°è¿è¡Œ
- `p`Â ï¼šå®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° 127.0.0.1:4030
- `-rm`ï¼šå®¹å™¨åœæ­¢è¿è¡Œåï¼Œè‡ªåŠ¨åˆ é™¤å®¹å™¨æ–‡ä»¶
- `-name`ï¼šå®¹å™¨çš„åå­—ä¸º mynginx
- æœ«å°¾çš„`nginx`ï¼šè¡¨ç¤ºæ ¹æ® nginx é•œåƒè¿è¡Œå®¹å™¨ã€‚

å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œå°±å¯ä»¥æ‰“å¼€æµè§ˆå™¨è®¿é—®Â `IP:4030`Â äº†ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ˜¾ç¤º Nginx çš„æ¬¢è¿é¡µã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l5ZagQ5hBqLVp9KHCLl6M3uGhvBJQD4kZrhBLYrRFwan9qytWthlE6w/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l5ZagQ5hBqLVp9KHCLl6M3uGhvBJQD4kZrhBLYrRFwan9qytWthlE6w/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

ç„¶åï¼ŒæŠŠè¿™ä¸ªå®¹å™¨ç»ˆæ­¢ï¼Œç”±äº`--rm`å‚æ•°çš„ä½œç”¨ï¼Œå®¹å™¨æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ é™¤ã€‚

```
dockerÂ containerÂ stopÂ mynginx

```

### **Docker å†…é…ç½® Nginx æ–¹å¼äºŒ**

ä¸‹è½½ä¸€ä¸ªå®˜æ–¹çš„Â `Nginx`Â é•œåƒåˆ°æœ¬åœ°

```
dockerÂ pullÂ nginx

```

ä¸‹è½½å¥½çš„é•œåƒå°±ä¼šå‡ºç°åœ¨é•œåƒåˆ—è¡¨é‡Œ

```
dockerÂ images

```

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lpMxhlDxjM1g5frc425mYONzcwq3D2weO2ZFvz93A3e7T4HoOib2WjQg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lpMxhlDxjM1g5frc425mYONzcwq3D2weO2ZFvz93A3e7T4HoOib2WjQg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

**è¿è¡Œå®¹å™¨**

```
dockerÂ runÂ --name=nginxÂ -dÂ -pÂ 4030:80Â nginx

```

ä¸Šé¢å‘½ä»¤çš„è§£é‡Šå¦‚ä¸‹ï¼š

1. `-name`ï¼šè®¾ç½®å®¹å™¨çš„åç§°;
2. `d`ï¼šè¡¨ç¤ºåœ¨åå°è¿è¡Œå®¹å™¨;
3. `p`ï¼šæŒ‡å®šç«¯å£æ˜ å°„ã€‚`4030`æ˜¯å®¿ä¸»æœºçš„ç«¯å£ï¼Œ`80`æ˜¯ Nginx å®¹å™¨å†…éƒ¨çš„ç«¯å£;
4. æœ«å°¾çš„`nginx`ï¼šè¡¨ç¤ºæ ¹æ® nginx é•œåƒè¿è¡Œå®¹å™¨ã€‚

å¦‚å›¾æ‰€ç¤º

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lCEbfb7dkviaVSsSglialAsozJFv0o2R3AtUdcwqrddbibQSfnIcqADibmg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lCEbfb7dkviaVSsSglialAsozJFv0o2R3AtUdcwqrddbibQSfnIcqADibmg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

ç„¶ååœ¨æµè§ˆå™¨é‡Œé¢è®¿é—®Â `http://47.93.242.155:4030/`

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l5ZagQ5hBqLVp9KHCLl6M3uGhvBJQD4kZrhBLYrRFwan9qytWthlE6w/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l5ZagQ5hBqLVp9KHCLl6M3uGhvBJQD4kZrhBLYrRFwan9qytWthlE6w/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **ç»™ Docker å†…çš„ Nginx é…ç½®åå‘ä»£ç†**

è¦ä¿®æ”¹ Nginx çš„é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆéœ€è¦è¿›å…¥ Nginx å®¹å™¨é‡Œé¢ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤**è¿›å…¥å®¹å™¨é‡Œé¢**

```
dockerÂ execÂ -itÂ nginxÂ /bin/bash

```

ä¸Šé¢å‘½ä»¤çš„è§£é‡Šè¯´æ˜ï¼š

- `it`ï¼šè¡¨ç¤ºåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚
- `nginx`ï¼šè¡¨ç¤ºå®¹å™¨çš„åç§°ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨å®¹å™¨ IDã€‚
- `/bin/bash`ï¼šè¡¨ç¤ºå¯¹å®¹å™¨æ‰§è¡Œ bash æ“ä½œã€‚

æˆ‘ä»¬ä½¿ç”¨`ls`æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ç»“æ„ï¼Œå‘ç°é‡Œé¢å…¶å®å°±æ˜¯ä¸€ä¸ªÂ `Linux`Â æ“ä½œç³»ç»Ÿã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lx40DdI3Km1Pl9wiaM8EvxSjvlAWViaQdCfZia5AI8FJ8wVRtEiaZ9x1vew/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lx40DdI3Km1Pl9wiaM8EvxSjvlAWViaQdCfZia5AI8FJ8wVRtEiaZ9x1vew/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

å†æŸ¥çœ‹ä¸€ä¸‹è¯¦ç»†çš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¿¡æ¯

```
catÂ /etc/issue

```

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lqYpO1K0xM6GaFE8VZh261kXBhou5GzTYstBjoI4dl4rmQ7cbbsvb8g/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lqYpO1K0xM6GaFE8VZh261kXBhou5GzTYstBjoI4dl4rmQ7cbbsvb8g/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

å¯ä»¥å‘ç°æ˜¯ä¸€ä¸ª`Debian`ç³»ç»Ÿ

### **`Debian`ç³»ç»Ÿ**

é¡ºä¾¿ä»‹ç»ä¸€äº›Â `Debian`ç³»ç»Ÿçš„åŸºæœ¬æ“ä½œ

```
#Â é¦–å…ˆéœ€è¦æ›´æ–°ä¸€ä¸‹
apt-getÂ update
Â #Â å®‰è£…vim
apt-getÂ installÂ vim

```

### **ä¿®æ”¹ä¸ºæ¸…åæºé•œåƒ**

å‚è€ƒ**Debian é•œåƒä½¿ç”¨å¸®åŠ©[10]**

å¦‚æœé‡åˆ°æ— æ³•æ‹‰å– https æºçš„æƒ…å†µï¼Œè¯·å…ˆä½¿ç”¨ http æºå¹¶å®‰è£…ï¼š

```
sudoÂ aptÂ installÂ apt-transport-httpsÂ ca-certificates

```

æŸ¥çœ‹ Debian ç‰ˆæœ¬,ä»¥ä¾¿é€‰æ‹©å¯¹åº”çš„é•œåƒæº

Debian ç‰ˆæœ¬ç®€ä»‹:

- ä¸‹ä¸€ä»£ Debian æ­£å¼å‘è¡Œç‰ˆçš„ä»£å·ä¸ºÂ `buster`
- Debian 9ï¼ˆ`stretch`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian 8ï¼ˆ`jessie`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian 7ï¼ˆ`wheezy`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian 6.0ï¼ˆ`squeeze`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 5.0ï¼ˆ`lenny`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 4.0ï¼ˆ`etch`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 3.1ï¼ˆ`sarge`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 3.0ï¼ˆ`woody`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 2.2ï¼ˆ`potato`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 2.1ï¼ˆ`slink`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 2.0ï¼ˆ`hamm`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ

æŸ¥çœ‹ç‰ˆæœ¬å½“å‰æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¿¡æ¯ã€‚è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥æ¸…æ¥šçš„çŸ¥é“åˆ°åº•æ˜¯ RedHat çš„ã€è¿˜æ˜¯åˆ«çš„å‘è¡Œç‰ˆï¼Œè¿˜æœ‰å…·ä½“çš„ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ 3.4 è¿˜æ˜¯ 5.4 ç­‰ç­‰

```
catÂ /etc/os-release

```

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l5mE23T0we7qQibTkAcg8Hia6ZjFepzVENojauv5qiadJZwGwRvGibpnbWw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l5mE23T0we7qQibTkAcg8Hia6ZjFepzVENojauv5qiadJZwGwRvGibpnbWw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

ä¿®æ”¹é•œåƒæ–‡ä»¶

```
viÂ /etc/apt/sources.list

```

ä¿®æ”¹å†…å®¹å¦‚ä¸‹

```
#Â é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜Â aptÂ updateÂ é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š
debÂ https://mirrors.tuna.tsinghua.edu.cn/debian/Â busterÂ mainÂ contribÂ non-free
#Â deb-srcÂ https://mirrors.tuna.tsinghua.edu.cn/debian/Â busterÂ mainÂ contribÂ non-free
debÂ https://mirrors.tuna.tsinghua.edu.cn/debian/Â buster-updatesÂ mainÂ contribÂ non-free
#Â deb-srcÂ https://mirrors.tuna.tsinghua.edu.cn/debian/Â buster-updatesÂ mainÂ contribÂ non-free
debÂ https://mirrors.tuna.tsinghua.edu.cn/debian/Â buster-backportsÂ mainÂ contribÂ non-free
#Â deb-srcÂ https://mirrors.tuna.tsinghua.edu.cn/debian/Â buster-backportsÂ mainÂ contribÂ non-free
debÂ https://mirrors.tuna.tsinghua.edu.cn/debian-securityÂ buster/updatesÂ mainÂ contribÂ non-free
#Â deb-srcÂ https://mirrors.tuna.tsinghua.edu.cn/debian-securityÂ buster/updatesÂ mainÂ contribÂ non-free

```

---

Nginx é»˜è®¤ä¼šå®‰è£…åœ¨Â `etc`Â ç›®å½•ä¸‹é¢, æŸ¥çœ‹ Nginx çš„é…ç½®æ–‡ä»¶çš„å†…å®¹

```
catÂ /etc/nginx/nginx.conf

```

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2luWVlfD1qENKmABqxLUCdBgib29E0vEnMtM56kbH8FOBZHGsHV3uSNXA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2luWVlfD1qENKmABqxLUCdBgib29E0vEnMtM56kbH8FOBZHGsHV3uSNXA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

æˆ‘ä»¬çœ‹æœ€åçº¢æ¡†é‡Œé¢çš„å†…å®¹ï¼Œè¡¨ç¤ºä½¿ç”¨çš„æ˜¯`/etc/nginx/conf.d/default.conf`æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚

é‚£ä¹ˆæˆ‘ä»¬ç¼–è¾‘`/etc/nginx/conf.d/default.conf`æ–‡ä»¶å³å¯ã€‚

```
viÂ /etc/nginx/conf.d/default.conf

```

**é…ç½®æ–¹å¼ä¸å‰æ–‡çš„ nginx é…ç½®ä¸€æ ·**ï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦æŠŠå¿…è¦çš„æ–‡ä»¶(é™æ€æ–‡ä»¶,SSL è¯ä¹¦)ä¼ é€’ç»™ Docker å®¹å™¨

åˆ›å»ºå­˜æ”¾èµ„æºçš„ç›®å½•

```
mkdirÂ /data/cert

mkdirÂ /data/www

```

**é€€å‡ºÂ `docker`Â å®¹å™¨**ï¼Œåˆ°æœåŠ¡å™¨ç•Œé¢

```
exit

```

**æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ä¿¡æ¯**ï¼Œèƒ½è·å–å®¹å™¨çš„Â `id`,å¦‚ä¸‹å›¾

```
dockerÂ psÂ -a

```

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l06mlsuDtYULb9kqiaZprkthClESNfWaibR4ZSup1q0MKUqhjTfDpDRfQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l06mlsuDtYULb9kqiaZprkthClESNfWaibR4ZSup1q0MKUqhjTfDpDRfQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

åœ¨æœåŠ¡å™¨ç»ˆç«¯æŠŠèµ„æºæ–‡ä»¶ä¼ é€’ç»™Â `docker`ä¸‹çš„`nginx`å®¹å™¨

```
dockerÂ cpÂ /data/certÂ 6ba3901beac9:/data/cert

```

**ä¿å­˜å®¹å™¨**

ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä¿å­˜é•œåƒï¼š

```
dockerÂ commitÂ -m="å¤‡æ³¨"Â ä½ çš„CONTAINER_IDÂ ä½ çš„IMAGE

```

> è¯·è‡ªè¡Œå°† -m åé¢çš„ä¿¡æ¯æ”¹æˆè‡ªå·±çš„å®¹å™¨çš„ä¿¡æ¯
> 

å¤§åŠŸå‘Šæˆï¼

æ­å–œä½ ç»“æŸäº† Docker çš„æ•™ç¨‹å¹¶å­¦ä¼šäº† Docker çš„ä¸€äº›åŸºæœ¬æ“ä½œ

## **Centos ä¸‹å®‰è£… Jenkins**

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2ljkXicrkrwibWbSibRzN6sm0NxzxgBjLU18vTJWKiceCOPPrDNWk04SxOew/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2ljkXicrkrwibWbSibRzN6sm0NxzxgBjLU18vTJWKiceCOPPrDNWk04SxOew/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

`Jenkins`Â æ˜¯ä¸€ä¸ªåŸºäºÂ `Java`Â è¯­è¨€å¼€å‘çš„æŒç»­æ„å»ºå·¥å…·å¹³å°ï¼Œä¸»è¦ç”¨äºæŒç»­ã€è‡ªåŠ¨çš„æ„å»º/æµ‹è¯•ä½ çš„è½¯ä»¶å’Œé¡¹ç›®ã€‚å®ƒå¯ä»¥æ‰§è¡Œä½ é¢„å…ˆè®¾å®šå¥½çš„è®¾ç½®å’Œæ„å»ºè„šæœ¬ï¼Œä¹Ÿå¯ä»¥å’ŒÂ `Git`Â ä»£ç åº“åšé›†æˆï¼Œå®ç°è‡ªåŠ¨è§¦å‘å’Œå®šæ—¶è§¦å‘æ„å»ºã€‚

è¿™éƒ¨åˆ†å†…å®¹å¤§å¤šå†…å®¹æ˜¯å¯¹**ä» 0 åˆ° 1 å®ç°ä¸€å¥— CI/CD æµç¨‹[11]**Â æ˜é‡‘å°å†Œçš„æ¬è¿ï¼Œæ›´è¯¦ç»†çš„å†…å®¹å¯ä»¥å­¦ä¹ è¿™æœ¬å°å†Œ

### **å®‰è£… OpenJDK**

å› ä¸ºÂ `Jenkins`Â æ˜¯Â `Java`Â ç¼–å†™çš„æŒç»­æ„å»ºå¹³å°ï¼Œæ‰€ä»¥å®‰è£…Â `Java`Â å¿…ä¸å¯å°‘ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©å®‰è£…å¼€æºçš„Â `openjdk`Â ã€‚åœ¨è¿™æˆ‘ä»¬ç›´æ¥ä½¿ç”¨Â `yum`Â åŒ…ç®¡ç†å™¨å®‰è£…Â `openjdk`Â å³å¯ã€‚

```
yumÂ installÂ -yÂ java

```

### **ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå®‰è£… Jenkins**

**å®˜æ–¹æ•™ç¨‹[12]**Â å®‰è£…é€Ÿåº¦å¤ªæ…¢ã€‚å› æ­¤æˆ‘ä»¬é€‰æ‹©å›½å†…é•œåƒå®‰è£…

ä¸‹é¢æ˜¯(2021/04)çš„ jenkins LTS ç‰ˆæœ¬: å¯ä»¥åœ¨å»Â **æ¸…åå¤§å­¦é•œåƒç«™[13]**Â çœ‹ä¸€ä¸‹ï¼Œæ›¿æ¢æˆæœ€æ–°çš„é“¾æ¥

ä¸‹è½½Â `Jenkins`Â åˆ°`/data`Â ç›®å½•

```
cdÂ Â /data

wgetÂ https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/jenkins-2.277.2-1.1.noarch.rpm

sudoÂ yumÂ installÂ jenkins-2.277.2-1.1.noarch.rpm

```

### **å¯åŠ¨ Jenkins**

`Jenkins`Â å®‰è£…åï¼Œä¼šå°†å¯åŠ¨å‘½ä»¤æ³¨å†Œåˆ°ç³»ç»ŸÂ `Service`Â å‘½ä»¤ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç³»ç»ŸÂ `service`Â å‘½ä»¤å¯åŠ¨Â `Jenkins`Â å³å¯ã€‚

åœ¨è¿™é‡Œï¼Œæœ‰ä¸‰ä¸ªå‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼Œåˆ†åˆ«å¯¹åº” å¯åŠ¨ / é‡å¯ / åœæ­¢ ä¸‰ä¸ªå‘½ä»¤ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨Â `service jenkins start`Â å¯åŠ¨Â `Jenkins`Â å³å¯

```
serviceÂ jenkinsÂ start
#Â serviceÂ jenkinsÂ restartÂ restartÂ é‡å¯Â Jenkins
#Â serviceÂ jenkinsÂ restartÂ stopÂ åœæ­¢Â Jenkins

```

æœåŠ¡å¯åŠ¨åï¼Œè®¿é—®Â `IP:8080`Â ã€‚å¦‚æœèƒ½å¤Ÿçœ‹åˆ°ä»¥ä¸‹ç•Œé¢ï¼Œä»£è¡¨æ­£åœ¨å¯åŠ¨ã€‚`Jenkins`Â ç¬¬ä¸€æ¬¡çš„å¯åŠ¨æ—¶é—´ä¸€èˆ¬æ¯”è¾ƒé•¿ï¼ˆè§†æœåŠ¡å™¨æ€§èƒ½è€Œçœ‹ï¼‰

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxjVVKE0NvqAT2ETCLsRARVCQvwpMw6vRUbb3QW8weDv8bnCxyeVrFg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxjVVKE0NvqAT2ETCLsRARVCQvwpMw6vRUbb3QW8weDv8bnCxyeVrFg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **åˆå§‹åŒ– Jenkins é…ç½®**

### **è§£é” Jenkins**

åœ¨Â `Jenkins`Â å¯åŠ¨å®Œæˆåï¼Œä¼šè‡ªåŠ¨è·³è½¬è‡³è¿™ä¸ªç•Œé¢ï¼ˆä¸‹æ–¹äºŒå›¾ï¼‰ã€‚è¿™æ˜¯Â `Jenkins`Â çš„è§£é”ç•Œé¢ï¼Œä½ éœ€è¦è¾“å…¥å­˜æ”¾åœ¨æœåŠ¡å™¨çš„åˆå§‹è§£é”å¯†ç æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚

`Jenkins`Â å¯åŠ¨åï¼Œä¼šç”Ÿæˆä¸€ä¸ªåˆå§‹å¯†ç ã€‚è¯¥å¯†ç åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶å†…å­˜æ”¾ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥æœåŠ¡å™¨æŸ¥çœ‹å¯†ç å†…å®¹ï¼Œå°†å¯†ç å¡«å†™åœ¨Â `Jenkins`Â çš„ç®¡ç†å‘˜å¯†ç è¾“å…¥æ¡†å†…ï¼š

```
catÂ /var/lib/jenkins/secrets/initialAdminPassword

```

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lwR2O3IFN4r42QMvsP5j0nfg7JAe9QmtdAFqjuQBpvT59c9Gee5FN7A/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lwR2O3IFN4r42QMvsP5j0nfg7JAe9QmtdAFqjuQBpvT59c9Gee5FN7A/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lNRQPo4BUWTvLWn4DGHWTZiaPsp6EibQZj90Ih2scjKtgxohmFlNTveGw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lNRQPo4BUWTvLWn4DGHWTZiaPsp6EibQZj90Ih2scjKtgxohmFlNTveGw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

ç‚¹å‡» ç»§ç»­ æŒ‰é’®ï¼Œè§£é” Jenkinsã€‚

### **ä¸‹è½½æ’ä»¶**

è§£é”åå°±æ¥åˆ°äº†æ’ä»¶ä¸‹è½½é¡µé¢ï¼Œè¿™ä¸€æ­¥è¦ä¸‹è½½ä¸€äº›Â `Jenkins`Â çš„åŠŸèƒ½æ’ä»¶ã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lCEvPcgNqQ6UH0msRDeZ8icM6DS0fGhffqgmdlT7r4S3el5lyA1WWJTA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lCEvPcgNqQ6UH0msRDeZ8icM6DS0fGhffqgmdlT7r4S3el5lyA1WWJTA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

å› ä¸ºÂ `Jenkins`Â æ’ä»¶æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œæ‰€ä»¥é€Ÿåº¦ä¸å¤ªç†æƒ³ã€‚æˆ‘ä»¬éœ€è¦æ›´æ¢ä¸ºæ¸…åå¤§å­¦çš„Â `Jenkins`Â æ’ä»¶æºåï¼Œå†å®‰è£…æ’ä»¶ï¼Œæ‰€ä»¥å…ˆä¸è¦ç‚¹å®‰è£…æ’ä»¶ã€‚

æ›´æ¢æ–¹æ³•å¾ˆç®€å•ã€‚è¿›å…¥æœåŠ¡å™¨ï¼Œå°†Â `/var/lib/jenkins/updates/default.json`Â å†…çš„æ’ä»¶æºåœ°å€æ›¿æ¢æˆæ¸…åå¤§å­¦çš„æºåœ°å€ï¼Œå°†Â `google`Â æ›¿æ¢ä¸ºÂ `baidu`Â å³å¯ã€‚

```
sedÂ -iÂ 's/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g'Â /var/lib/jenkins/updates/default.jsonÂ &&Â sedÂ -iÂ 's/http:\/\/www.google.com/https:\/\/www.baidu.com/g'Â /var/lib/jenkins/updates/default.json

```

æ¥ç€ç‚¹å‡» å®‰è£…æ¨èçš„æ’ä»¶ å³å¯ã€‚ç¨ç­‰ä¸€ä¼šæ’ä»¶å®‰è£…å®Œæ¯•

### **å®Œæˆå®‰è£…**

æ’ä»¶å®‰è£…å®Œæ¯•åï¼Œæ¥ç€æ˜¯æ³¨å†Œç®¡ç†å‘˜è´¦å·ã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lDBTvrby4aYwichZon5LXiaxa9gtsgPKTkmf352JteHr2KzibB60Hzh62A/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lDBTvrby4aYwichZon5LXiaxa9gtsgPKTkmf352JteHr2KzibB60Hzh62A/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

æŒ‰ç…§æç¤ºä¸€è·¯é…ç½®åï¼Œç›´åˆ°çœ‹åˆ°ä»¥ä¸‹ç•Œé¢ä»£è¡¨å®‰è£…æˆåŠŸ

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lIEic22lLyUz2bsvnibOcfd3Q3vIp53rr6jRrJgHo2KFwhEcXpk97B3hg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lIEic22lLyUz2bsvnibOcfd3Q3vIp53rr6jRrJgHo2KFwhEcXpk97B3hg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **æµ‹è¯•å®‰è£…**

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„Â `Jenkins`Â ç®—æ˜¯å¯åŠ¨æˆåŠŸäº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹Â `Jenkins`Â åšä¸€ç‚¹ç‚¹ç®€å•çš„é…ç½®ï¼Œæ‰å¯ä»¥è®©å®ƒå¯ä»¥æ„å»ºÂ `docker`Â é•œåƒã€‚

æˆ‘ä»¬ç‚¹å‡»Â `Jenkins é¦–é¡µ`Â ->Â `å·¦ä¾§å¯¼èˆª`Â ->Â `æ–°å»ºä»»åŠ¡`Â ->Â `Freestyle project(æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®)`

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2libOVJsunicp9dk2icvia9vrJDwkQIA67TicYGK3QRJYDcNH582xMBMWCxDg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2libOVJsunicp9dk2icvia9vrJDwkQIA67TicYGK3QRJYDcNH582xMBMWCxDg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

æ–°å»ºå®Œæ¯•åï¼Œæ‰¾åˆ° æ„å»º ä¸€é¡¹ï¼Œé€‰æ‹© å¢åŠ æ„å»ºæ­¥éª¤ï¼Œé€‰æ‹© æ‰§è¡ŒÂ `shell`Â ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤

```
dockerÂ -v
dockerÂ pullÂ node:latest

```

è¯¥å‘½ä»¤ä¼šå»æ‹‰å–ä¸€ä¸ªÂ `nodejs`Â ç¨³å®šç‰ˆçš„é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•Â `Docker`Â çš„å¯ç”¨æ€§

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lK0TtKxzpnV5hnD01NaOy9t1mafPJZPSaC6o8MaHwviadaTboibS6CqLg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lK0TtKxzpnV5hnD01NaOy9t1mafPJZPSaC6o8MaHwviadaTboibS6CqLg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

ä¿å­˜åï¼Œæˆ‘ä»¬ç‚¹å‡»å·¦ä¾§èœå•çš„ç«‹å³æ„å»ºï¼ŒÂ `Jenkins`Â å°±ä¼šå¼€å§‹æ„å»ºã€‚é€‰æ‹©å·¦ä¾§å†å²è®°å½•ç¬¬ä¸€é¡¹ï¼ˆæœ€æ–°çš„ä¸€é¡¹ï¼‰ï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºï¼ŒæŸ¥çœ‹æ„å»ºæ—¥å¿—ã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lnSB0UhUSWYq85VfZD5EDmxh7lY3bD7RjkkUv4eicJOuibAwPYNvpzTMg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lnSB0UhUSWYq85VfZD5EDmxh7lY3bD7RjkkUv4eicJOuibAwPYNvpzTMg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

æ‰§è¡Œåï¼Œæˆ‘ä»¬å‘ç°æç¤ºæ— è®¿é—®æƒé™ã€‚è¿™åˆæ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿè¿™é‡Œå°±ä¸å¾—ä¸æåˆ° Linux ä¸‹çš„Â `Unix Socket`Â æƒé™é—®é¢˜äº†

åœ¨Â `Linux`Â ä¸­ï¼ŒÂ `Unix socket`Â å±äºÂ `root`Â ç”¨æˆ·ï¼Œå› æ­¤éœ€è¦Â `root`Â æƒé™æ‰èƒ½è®¿é—®

ä½†æ˜¯åœ¨Â `docker`Â ä¸­ï¼ŒÂ `docker`Â æä¾›äº†ä¸€ä¸ª ç”¨æˆ·ç»„ çš„æ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥å°†æ‰§è¡ŒÂ `Shell`Â çš„ç”¨æˆ·æ·»åŠ åˆ°åç§°ä¸ºÂ `docker`Â çš„ç”¨æˆ·ç»„ï¼Œåˆ™å¯ä»¥æ­£å¸¸æ‰§è¡ŒÂ `docker`Â å‘½ä»¤ã€‚

è€Œåœ¨Â `Jenkins`Â ä¸­æ‰§è¡Œçš„ç»ˆç«¯ç”¨æˆ·åšÂ `jenkins`Â ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†Â `jenkins`Â åŠ å…¥åˆ°Â `docker`Â ç”¨æˆ·ç»„å³å¯ï¼š

```
sudoÂ groupaddÂ dockerÂ Â Â Â Â Â Â Â Â Â #æ–°å¢dockerç”¨æˆ·ç»„
sudoÂ gpasswdÂ -aÂ jenkinsÂ dockerÂ Â #å°†å½“å‰ç”¨æˆ·æ·»åŠ è‡³dockerç”¨æˆ·ç»„
newgrpÂ dockerÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â #æ›´æ–°dockerç”¨æˆ·ç»„

```

åŠ å…¥åï¼Œé‡å¯Â `Jenkins`Â ï¼š

```
sudoÂ serviceÂ jenkinsÂ restart

```

é‡å¯Â `Jenkins`Â åï¼Œå†æ¬¡æ‰§è¡Œè„šæœ¬ã€‚æ­¤æ—¶æ‰§è¡ŒæˆåŠŸï¼š

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lbPFQDlUsU2pDv5onEwFEiatbSanPkCLmGZGYgAMpIeKrqKLo6sEMlsw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lbPFQDlUsU2pDv5onEwFEiatbSanPkCLmGZGYgAMpIeKrqKLo6sEMlsw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **å›è¿‡å¤´æ¥æŸ¥çœ‹ docker é•œåƒ**

```
dockerÂ images

```

ä¼šå‘ç°å¤šäº†ä¸€ä¸ª`docker`çš„`node`é•œåƒ,è¿™å°±æ˜¯æˆ‘ä»¬é€šè¿‡`Jenkins`Â è‡ªåŠ¨å®‰è£…çš„

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxPKDFas934PJQxbGkFsXRTPt3KfEKfhTE9kLCFL0ib91wQCgSicEDIBA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxPKDFas934PJQxbGkFsXRTPt3KfEKfhTE9kLCFL0ib91wQCgSicEDIBA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

è¿›å…¥æ­¤`docker`é•œåƒ

```
dockerÂ runÂ -itÂ nodeÂ /bin/bash

```

åšä¸€äº›é…ç½®(å¦‚ä½•åšå‚è€ƒå‰æ–‡çš„è¯´æ˜)

- `npm`Â é…ç½®æ·˜å®æº
- å…¨å±€å®‰è£…Â `yarn`Â å¹¶é…ç½®é…ç½®æ·˜å®æº

```
npmÂ configÂ setÂ registryÂ https://registry.npm.taobao.org

npmÂ getÂ registry
#Â å¯èƒ½æç¤ºå·²å®‰è£…ï¼Œå°±ä¸ç”¨å†å®‰è£…äº†
npmÂ installÂ yarnÂ -g

yarnÂ configÂ setÂ registryÂ http://registry.npm.taobao.org/

yarnÂ configÂ getÂ registry

exit

```

### **ä½¿ç”¨ SSH åè®®é›†æˆ Git ä»“åº“æº**

è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬ä½¿ç”¨Â `Jenkins`Â é›†æˆå¤–éƒ¨Â `Git`Â ä»“åº“ï¼Œå®ç°å¯¹çœŸå®ä»£ç çš„æ‹‰å–å’Œæ„å»ºã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰ç”¨Â `Gitee`(Github å¤ªæ…¢äº† ğŸ¤§) ä½œä¸ºæˆ‘ä»¬çš„ä»£ç æºã€‚è¿™é‡Œå‡†å¤‡ä¸€ä¸ªÂ **UmiJS[14]**Â é¡¹ç›®æ¥æ¼”ç¤ºæ„å»ºã€‚

### **ç”Ÿæˆå…¬é’¥ç§é’¥**

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥é…ç½®å…¬é’¥å’Œç§é’¥ã€‚è¿™æ˜¯Â `Jenkins`Â è®¿é—®Â `Git`Â ç§æœ‰åº“çš„å¸¸ç”¨è®¤è¯æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â `ssh-keygen`Â å‘½ä»¤å³å¯ç”Ÿæˆå…¬é’¥ç§é’¥ã€‚åœ¨æœ¬åœ°æœºå™¨æ‰§è¡Œç”Ÿæˆå³å¯ã€‚è¿™é‡Œçš„é‚®ç®±å¯ä»¥æ¢æˆä½ è‡ªå·±çš„é‚®ç®±ï¼š

```
ssh-keygenÂ -tÂ rsaÂ -CÂ "642178633@qq.com"

```

æ‰§è¡Œåï¼Œä¼šé‡åˆ°ç¬¬ä¸€æ­¥éª¤ï¼š`Enter file in which to save the key`Â ã€‚

è¿™ä¸€æ­¥æ˜¯è¯¢é—®ä½ è¦å°†å…¬é’¥ç§é’¥æ–‡ä»¶æ”¾åœ¨å“ªé‡Œã€‚é»˜è®¤æ˜¯æ”¾åœ¨Â `~/.ssh/id_rsa`Â ä¸‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©è¾“å…¥ä½ è‡ªå·±çš„è·¯å¾„ã€‚ä¸€è·¯å›è½¦å³å¯ã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lGxyZic7MhpeZIsYjqIicLpIhhdszNibOakIycJFicJZI5jhPtPTTbbbFjg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lGxyZic7MhpeZIsYjqIicLpIhhdszNibOakIycJFicJZI5jhPtPTTbbbFjg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

ç»“æŸåï¼Œä½ ä¼šå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ã€‚åˆ†åˆ«æ˜¯Â `id_rsa`Â å’ŒÂ `id_rsa.pub`ã€‚

å…¶ä¸­ï¼Œ`id_rsa`Â æ˜¯ç§é’¥æ–‡ä»¶ï¼Œ`id_rsa.pub`Â æ˜¯å¯¹åº”çš„å…¬é’¥æ–‡ä»¶ã€‚

æˆ‘ä»¬éœ€è¦åœ¨ Git ç«¯é…ç½®å…¬é’¥ï¼Œåœ¨ Jenkins ç«¯ä½¿ç”¨ç§é’¥ä¸ Git è¿›è¡Œèº«ä»½æ ¡éªŒã€‚

### **åœ¨ Gitee é…ç½®å…¬é’¥**

åœ¨Â `Gitee`Â ä¸­ï¼Œå¦‚æœä½ è¦é…ç½®å…¬é’¥æœ‰ 2 ç§æ–¹å¼ï¼šä»“åº“å…¬é’¥ å’Œ ä¸ªäººå…¬é’¥ã€‚å…¶ä¸­ï¼Œå¦‚æœé…ç½®äº†ä»“åº“å…¬é’¥ï¼Œåˆ™è¯¥å…¬é’¥åªèƒ½å¯¹é…ç½®çš„ä»“åº“è¿›è¡Œè®¿é—®ã€‚å¦‚æœé…ç½®äº†ä¸ªäººå…¬é’¥ï¼Œåˆ™è´¦å·ä¸‹æ‰€æœ‰ç§æœ‰ä»“åº“éƒ½å¯ä»¥è®¿é—®ã€‚

è¿™é‡Œæˆ‘ä»¬å°±ä»¥é…ç½®ä¸ªäººå…¬é’¥ä¸ºä¾‹å­ã€‚é¦–å…ˆæ‰“å¼€å³ä¸Šè§’çš„è®¾ç½® ï¼Œç‚¹å‡»ä¸‹é¢çš„Â `è®¾ç½®`Â =>Â `SSH å…¬é’¥`

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lkdOqmdmgeyKIVvjq2hPa9jUjhNXjGmZlSreTkBf03AIronzKFRKicUw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lkdOqmdmgeyKIVvjq2hPa9jUjhNXjGmZlSreTkBf03AIronzKFRKicUw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lQe1UaQpCt7SDv5zrC5dvib77lACrxUHFo4Ec8lZQCxHEBoiaacmiaicfvA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lQe1UaQpCt7SDv5zrC5dvib77lACrxUHFo4Ec8lZQCxHEBoiaacmiaicfvA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

åœ¨ä¸‹æ–¹æœ‰ä¸ªæ·»åŠ å…¬é’¥ï¼Œå¡«å…¥ä¿¡æ¯å³å¯ã€‚

å…¶ä¸­çš„æ ‡é¢˜ä¸ºå…¬é’¥æ ‡é¢˜ï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰æ ‡é¢˜ï¼›å…¬é’¥åˆ™ä¸ºåˆšæ‰ç”Ÿæˆçš„Â `id_rsa.pub`Â æ–‡ä»¶ã€‚ä½¿ç”¨Â `cat`Â å‘½ä»¤æŸ¥çœ‹ä¸‹æ–‡ä»¶å†…å®¹ï¼Œå°†å†…å®¹å¡«å…¥è¾“å…¥æ¡†å¹¶ä¿å­˜ã€‚æ¥ç€å»Â `Jenkins`Â ç«¯é…ç½®ç§é’¥

```
catÂ ~/.ssh/id_rsa.pub

```

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l4tX27uSkbJObhuvrfurpVpxFibG6YfPNA3YIaekYzq0cSsNcXseyrsQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l4tX27uSkbJObhuvrfurpVpxFibG6YfPNA3YIaekYzq0cSsNcXseyrsQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **åœ¨ Jenkins é…ç½®ç§é’¥**

å›åˆ°Â `Jenkins`ã€‚åœ¨Â `Jenkins`Â ä¸­ï¼Œç§é’¥/å¯†ç  ç­‰è®¤è¯ä¿¡æ¯éƒ½æ˜¯ä»¥ å‡­è¯ çš„æ–¹å¼ç®¡ç†çš„ï¼Œæ‰€ä»¥å¯ä»¥åšåˆ°å…¨å±€éƒ½é€šç”¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ä»»åŠ¡æ—¶ï¼Œæ¥æ·»åŠ ä¸€ä¸ªè‡ªå·±çš„å‡­è¯ã€‚ç‚¹å‡»é¡¹ç›®çš„ é…ç½®ï¼Œä¾æ¬¡æ‰¾åˆ°Â `æºç ç®¡ç†`Â =>Â `Git`Â =>Â `Repositories`

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l5kx7ia1uwT1Xs2X9U6Ih4Gbrg4bVEB6kklic4TBJibM1PLWEtH5MX5oiaQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l5kx7ia1uwT1Xs2X9U6Ih4Gbrg4bVEB6kklic4TBJibM1PLWEtH5MX5oiaQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lr3XbzEcowic4xSTtFJexpXuzPmgqo6oVEBkENT5n2KaicSCiatnbyj2kg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lr3XbzEcowic4xSTtFJexpXuzPmgqo6oVEBkENT5n2KaicSCiatnbyj2kg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

è¿™é‡Œçš„Â `Repository URL`Â åˆ™æ˜¯æˆ‘ä»¬çš„ä»“åº“åœ°å€ï¼Œ SSH åœ°å€æ ¼å¼ä¸ºÂ `git@gitee.com:xxx/xxx.git`Â ã€‚å¯ä»¥ä»ä»“åº“é¦–é¡µä¸­çš„Â `å…‹éš†/ä¸‹è½½`Â =>Â `SSH`Â ä¸­çœ‹åˆ°

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lbT0t1yibsQlWDxe5ArxlfnvvFEIzRmd5EWBOoz1ZNaKVAQEqtUAm4dA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lbT0t1yibsQlWDxe5ArxlfnvvFEIzRmd5EWBOoz1ZNaKVAQEqtUAm4dA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

é‡ç‚¹æ˜¯Â `Credentials`Â è¿™ä¸€é¡¹ï¼Œè¿™é‡Œåˆ™æ˜¯æˆ‘ä»¬é€‰æ‹©è®¤è¯å‡­è¯çš„åœ°æ–¹ã€‚æˆ‘ä»¬å¯ä»¥ç‚¹å‡»å³ä¾§Â `æ·»åŠ `Â =>Â `Jenkins`Â æŒ‰é’®æ·»åŠ ä¸€æ¡æ–°çš„å‡­è¯è®¤è¯ä¿¡æ¯ã€‚

ç‚¹å‡»åä¼šæ‰“å¼€ä¸€ä¸ªå¼¹çª—ï¼Œè¿™æ˜¯ Jenkins æ·»åŠ å‡­è¯çš„å¼¹çª—ã€‚é€‰æ‹©ç±»å‹ä¸­çš„Â `SSH Username with private key`Â è¿™ä¸€é¡¹ã€‚æ¥ç€å¡«å†™ä¿¡æ¯å³å¯ï¼š

- `ID`ï¼šè¿™æ¡è®¤è¯å‡­è¯åœ¨ Jenkins ä¸­çš„åç§°æ˜¯ä»€ä¹ˆ
- `æè¿°`ï¼šæè¿°ä¿¡æ¯
- `Username`ï¼šç”¨æˆ·åï¼ˆé‚®ç®±ï¼‰
- `Private Key`ï¼šè¿™é‡Œåˆ™æ˜¯æˆ‘ä»¬å¡«å†™ç§é’¥çš„åœ°æ–¹ã€‚

åœ¨å‘½ä»¤è¡Œçª—å£ï¼ŒæŸ¥çœ‹ç§é’¥æ–‡ä»¶å†…å®¹ï¼Œå¹¶å¤åˆ¶å®ƒ

```
catÂ ~/.ssh/id_rsa

```

ç‚¹å‡»Â `Add`Â æŒ‰é’®ï¼Œå°†Â `xxx ç§é’¥æ–‡ä»¶`å†…æ‰€æœ‰æ–‡ä»¶å†…å®¹å…¨éƒ¨å¤åˆ¶è¿‡å»ï¼ˆåŒ…å«å¼€å¤´çš„ BEGIN OPENSSH PRIVATE KEY å’Œç»“å°¾çš„ END OPENSSH PRIVATE KEYï¼‰

æ¥ç€ç‚¹å‡»æ·»åŠ æŒ‰é’®ï¼Œä¿å­˜å‡­è¯ã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lzjIjOfQAhoJ2FoMwnnyO89MvLEuV5XBgJ9EVEd9XwPBwGla6icAIfHA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lzjIjOfQAhoJ2FoMwnnyO89MvLEuV5XBgJ9EVEd9XwPBwGla6icAIfHA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

ä¿å­˜åï¼Œåœ¨Â `Credentials`Â ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ä½ æ·»åŠ çš„å‡­è¯ã€‚

å¦‚æœæ²¡æœ‰å‡ºç°çº¢è‰²æ— æƒé™æç¤ºï¼Œåˆ™ä»£è¡¨èº«ä»½æ ¡éªŒæˆåŠŸï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ã€‚

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lTib9zYbATP8hvVSXHIVlQYW6nVqYQictABiblm1QlMj5tGOWMkoHu7etQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lTib9zYbATP8hvVSXHIVlQYW6nVqYQictABiblm1QlMj5tGOWMkoHu7etQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

å¦‚æœå‡ºç°ä¸‹å›¾çš„é—®é¢˜ï¼Œåˆ™è¯´æ˜æœåŠ¡å™¨ä¸Šæ²¡æœ‰å®‰è£…Â `Git`

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lKVpec3g3NiaBCOL4BmTwnVjIEevvncDWwSHj1I1zAdgzYa47UJcr94g/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lKVpec3g3NiaBCOL4BmTwnVjIEevvncDWwSHj1I1zAdgzYa47UJcr94g/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

å®‰è£…ç»“æŸåï¼Œåˆ·æ–°ç•Œé¢å°±æ­£å¸¸äº†

```
yumÂ -yÂ installÂ git

```

### **æ„å»ºé•œåƒ**

åœ¨æˆ‘ä»¬å°†ç¯å¢ƒå‡†å¤‡å°±ç»ªåï¼Œå°±å¯ä»¥å¼€å§‹æ„å»ºé•œåƒäº†ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡ä¸ªÂ `DockerFile`Â æ‰å¯ä»¥æ„å»ºé•œåƒã€‚é‚£ä»€ä¹ˆæ˜¯Â `DockerFile`Â å‘¢ï¼Ÿ

### **ç¼–å†™ Dockerfile**

ä»€ä¹ˆæ˜¯Â `Dockerfile`

`Dockerfile`Â æ˜¯ä¸€ä¸ªÂ `Docker`Â é•œåƒçš„åŸºç¡€æè¿°æ–‡ä»¶ï¼Œé‡Œé¢æè¿°äº†ç”Ÿæˆä¸€ä¸ªé•œåƒæ‰€éœ€è¦çš„æ‰§è¡Œæ­¥éª¤ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä»½Â `Dockerfile`Â æ¥åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„é•œåƒã€‚

ä¾‹å¦‚ä¸‹é¢çš„æ­¥éª¤ï¼Œä½¿ç”¨Â `Dockerfile`Â å¯æè¿°ä¸ºï¼š

1. åŸºäºÂ `nginx:1.15`Â é•œåƒåšåº•åº§ã€‚
2. æ‹·è´æœ¬åœ°Â `html`Â æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ï¼Œåˆ°é•œåƒå†…Â `/etc/nginx/html`Â æ–‡ä»¶å¤¹ã€‚
3. æ‹·è´æœ¬åœ°Â `conf`Â æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ï¼Œåˆ°é•œåƒå†…Â `/etc/nginx/`Â æ–‡ä»¶å¤¹ã€‚

```
FROMÂ nginx:1.15-alpine
COPYÂ htmlÂ /etc/nginx/html
COPYÂ confÂ /etc/nginx/
WORKDIRÂ /etc/nginx/html

```

ç¼–å†™å®Œæˆåï¼Œæ€ä¹ˆç”Ÿæˆé•œåƒå‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨Â `docker build`Â å‘½ä»¤å°±å¯ä»¥æ„å»ºä¸€ä¸ªé•œåƒäº†ï¼š

```
dockerÂ buildÂ -tÂ imagename:versionÂ .

```

- `t`: å£°æ˜è¦æ‰“ä¸€ä¸ªé•œåƒçš„ Tag æ ‡ç­¾ï¼Œç´§è·Ÿç€çš„åé¢å°±æ˜¯æ ‡ç­¾ã€‚

æ ‡ç­¾æ ¼å¼ä¸ºÂ `é•œåƒå:ç‰ˆæœ¬ .`Â ï¼šå£°æ˜è¦å¯»æ‰¾`dockerfile`æ–‡ä»¶çš„è·¯å¾„.Â `.`ä»£è¡¨å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾ã€‚é»˜è®¤æ–‡ä»¶åä¸ºÂ `Dockerfile`ã€‚

å…³äºæ›´å¤šÂ `DockerFile`Â çš„è¯­æ³•ï¼Œè¯¦ç»†å¯ä»¥çœ‹**è¿™é‡Œ[15]**

å› ä¸ºæˆ‘ä»¬çš„é•œåƒåªåŒ…å«ä¸€ä¸ªÂ `nginx`ï¼Œæ‰€ä»¥Â `dockerfile`Â å†…å®¹æ¯”è¾ƒç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨ä»£ç æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸ºÂ `Dockerfile`Â çš„æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œå¹¶å°†å…¶æäº¤åˆ°**ä»£ç åº“[16]**å³å¯ã€‚

```
viÂ Dockerfile
FROMÂ nginx:1.15-alpine
COPYÂ htmlÂ /etc/nginx/html
COPYÂ confÂ /etc/nginx/
WORKDIRÂ /etc/nginx/html

```

```
gitÂ addÂ ./Dockerfile
gitÂ commitÂ -mÂ "chore:Â addÂ dockerfile"
gitÂ push

```

### **Jenkins ç«¯é…ç½®**

åœ¨ä»£ç æºå’ŒÂ `DockerFile`Â å‡†å¤‡å°±ç»ªåã€‚åœ¨æœåŠ¡å™¨çš„`/data`ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`jenkins-shll.sh`Â è„šæœ¬æ–‡ä»¶

```
touchÂ /data/jenkins-shll.sh

viÂ /data/jenkins-shll.sh

```

å¹¶åŠ å…¥å¦‚ä¸‹å†…å®¹

```
#!/bin/shÂ -l

yarn
yarnÂ runÂ build
dockerÂ buildÂ -tÂ jenkins-testÂ .

```

è¿™é‡Œè„šæœ¬å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯ä½œç”¨æ˜¯`å®‰è£…ä¾èµ–`Â =>Â `æ„å»ºæ–‡ä»¶`Â =>Â `æ„å»ºé•œåƒ`ã€‚

`#!/bin/sh -l`çš„ä½œç”¨æ˜¯:

å¦‚æœåœ¨æœåŠ¡å™¨ä¸­çš„`shell`å‘½ä»¤å¯ä»¥æ‰§è¡Œï¼Œä½†åˆ°äº†`jenkins`ä¸­å´æ— æ³•æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸º`jenkins`æ²¡æœ‰åŠ è½½æœåŠ¡å™¨ä¸­çš„å…¨å±€å˜é‡`/etc/profile`å¯¼è‡´çš„

---

æœ€ååªéœ€åœ¨Â `Jenkins`Â ç«¯é…ç½®ä¸‹è¦æ‰§è¡Œçš„Â `Shell`Â è„šæœ¬å³å¯ã€‚æ‰¾åˆ°é¡¹ç›®çš„é…ç½®ï¼Œä¾æ¬¡æ‰¾åˆ°`æ„å»º`Â =>Â `Execute shell`ã€‚è¾“å…¥ä»¥ä¸‹è„šæœ¬ï¼š

```
shÂ /data/jenkins-shll.sh

```

### **æ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡**

ä¿å­˜åæˆ‘ä»¬å»æ‰‹åŠ¨è§¦å‘æ‰§è¡Œä¸‹ä»»åŠ¡ã€‚å½“æœªæŠ›å‡ºé”™è¯¯æ—¶ï¼Œä»£è¡¨ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxvHyAk2zjw7bhCZp1vOG9Z1uww9CNmzzUESQDGWK90eciaBaxiasO5Xg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lxvHyAk2zjw7bhCZp1vOG9Z1uww9CNmzzUESQDGWK90eciaBaxiasO5Xg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **å›è¿‡å¤´æ¥æŸ¥çœ‹ docker**

```
dockerÂ images

```

å¯ä»¥å‘ç°ï¼Œåˆå¤šäº†ä¸€ä¸ªåå«`jenkins-test`Â çš„ docker é•œåƒ

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lHAkPITDDwB8ic6HIoyJwfZ1LyFlhmSORu1TDB9dEKjjDyictzgKT6Rdg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2lHAkPITDDwB8ic6HIoyJwfZ1LyFlhmSORu1TDB9dEKjjDyictzgKT6Rdg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

### **è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡**

### **å®‰è£…æ’ä»¶**

å®‰è£…Â `Generic Webhook Trigger Plugin`Â æ’ä»¶ï¼ˆ`ç³»ç»Ÿç®¡ç†`-`æ’ä»¶ç®¡ç†`-`å¯ç”¨æ’ä»¶`-æœç´¢Â `Generic Webhook`ï¼‰

é€‰ä¸­å¹¶ç‚¹å‡»`Install without restart`

[https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l9rTJF0p7KvuFwuV4x7GEjbia86SvwFfYsV4jTgxXZugw5YsSrYoibiaGQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHp0yNsS4SmrTGAhzOKd2G2l9rTJF0p7KvuFwuV4x7GEjbia86SvwFfYsV4jTgxXZugw5YsSrYoibiaGQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

å¦‚æœå¯é€‰æ’ä»¶åˆ—è¡¨ä¸ºç©ºï¼Œç‚¹å‡»é«˜çº§æ ‡ç­¾é¡µï¼Œæ›¿æ¢å‡çº§ç«™ç‚¹çš„ URL ä¸ºï¼š`http://mirror.xmission.com/jenkins/updates/update-center.json`å¹¶ä¸”ç‚¹å‡»æäº¤å’Œç«‹å³è·å–ã€‚

### **æ·»åŠ è§¦å‘å™¨**

`Generic Webhook Trigger Plugin`Â æ’ä»¶åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„è§¦å‘å‚æ•°è§¦å‘ä¸åŒçš„æ„å»ºæ“ä½œï¼Œæ¯”å¦‚æˆ‘å‘è¿œç¨‹ä»“åº“æäº¤çš„æ˜¯Â `master`Â åˆ†æ”¯çš„ä»£ç ï¼Œå°±æ‰§è¡Œä»£ç éƒ¨ç½²å·¥ä½œï¼Œæˆ‘å‘è¿œç¨‹ä»“åº“æäº¤çš„æ˜¯æŸä¸ªÂ `feature`åˆ†æ”¯ï¼Œå°±æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œå•å…ƒæµ‹è¯•é€šè¿‡ååˆå¹¶è‡³Â `dev`Â åˆ†æ”¯ã€‚

çµæ´»æ€§å¾ˆé«˜ï¼Œå¯ä»¥è‡ªå®šä¹‰é…ç½®é€‚åˆè‡ªå·±å…¬å¸çš„æ–¹æ¡ˆï¼Œè¿™é‡Œæ–¹ä¾¿æ¼”ç¤ºæˆ‘ä»¬ä¸åšä»»ä½•æ¡ä»¶åˆ¤æ–­ï¼Œåªè¦æœ‰`push`å°±è§¦å‘ã€‚

åœ¨ä»»åŠ¡é…ç½®->`è§¦å‘æ„å»ºèµ·`->é‡Œå‹¾é€‰Â `Generic Webhook Trigger`Â ï¼Œç„¶åä¿å­˜å³å¯

![Untitled](%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%80%85%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%20Centos%20Docker%20Nginx%20Node%20Jenkins%20%E6%93%8D%E4%BD%9C%2088481b53f8d0492ca62434a0a42a2122/Untitled%201.png)

[data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

### **Git ä»“åº“é…ç½®é’©å­**

æ­¤å¤„ä»¥ç äº‘ä¸ºä¾‹ï¼Œgithub çš„é…ç½®åŸºæœ¬ä¸€è‡´ï¼Œè¿›å…¥ç äº‘é¡¹ç›®ä¸»é¡µåï¼Œç‚¹å‡»`ç®¡ç†`-`webhooks`-`æ·»åŠ `ï¼Œä¼šè·³å‡ºä¸€ä¸ªè¿™æ ·çš„æ¡†æ¥ã€‚

![Untitled](%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%80%85%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%20Centos%20Docker%20Nginx%20Node%20Jenkins%20%E6%93%8D%E4%BD%9C%2088481b53f8d0492ca62434a0a42a2122/Untitled%202.png)

[data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

ä¸Šå›¾ä¸­çš„ URL æ ¼å¼ä¸ºÂ `http://<User ID>:<API Token>@<Jenkins IP åœ°å€>:ç«¯å£/generic-webhook-trigger/invoke`

ä¸‹é¢çš„å‡ ä¸ªé€‰é¡¹æ˜¯ä½ åœ¨ä»“åº“æ‰§è¡Œä»€ä¹ˆæ“ä½œçš„æ—¶å€™è§¦å‘é’©å­ï¼Œè¿™é‡Œé»˜è®¤ç”¨Â `push`ã€‚

- è·å–`User ID`

![Untitled](%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%80%85%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%20Centos%20Docker%20Nginx%20Node%20Jenkins%20%E6%93%8D%E4%BD%9C%2088481b53f8d0492ca62434a0a42a2122/Untitled%203.png)

è¿›å…¥ jenkin çš„`ç³»ç»Ÿç®¡ç†`->`ç®¡ç†ç”¨æˆ·`Â ç•Œé¢, å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ã€‚åœ¨æ­¤åˆ—è¡¨ä¸­å°±æ‰¾åˆ°`User ID`.

[data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- è·å–`API Token`

æ¥ä¸‹æ¥ç‚¹å‡»`å·¥å…·å›¾æ ‡`Â è¿›å…¥è¯¦æƒ…ç•Œé¢åæ‰¾åˆ°`API Token`->`æ·»åŠ æ–°Token`->`ç”Ÿæˆ`->æ‰¾ä¸ªä½ å–œæ¬¢çš„åœ°æ–¹å°†æ­¤ token ä¿å­˜å¥½

- è·å–ç«¯å£

`Jenkins IP åœ°å€`å’Œç«¯å£æ˜¯ä½ éƒ¨ç½² jenkins æœåŠ¡å™¨çš„ ip åœ°å€ï¼Œç«¯å£å·æ²¡æ”¹è¿‡çš„è¯å°±æ˜¯Â `8080`ã€‚

- è·å–å¯†ç 

`å¯†ç `å°±æ˜¯ä½ ç™»å½• jenkins çš„å¯†ç 

ç‚¹å‡»æäº¤å®Œæˆé…ç½®ã€‚æˆ‘ä»¬è¿˜éœ€è¦æµ‹è¯•ä¸€ä¸‹é’©å­æ˜¯å¦ç”Ÿæ•ˆ

![Untitled](%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%80%85%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%20Centos%20Docker%20Nginx%20Node%20Jenkins%20%E6%93%8D%E4%BD%9C%2088481b53f8d0492ca62434a0a42a2122/Untitled%204.png)

[data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

ç‚¹å‡»`æµ‹è¯•`ï¼Œå¦‚æœé…ç½®æ˜¯æˆåŠŸçš„ï¼Œä½ çš„Â `Jenkins`Â å·¦ä¾§æ æ„å»ºæ‰§è¡ŒçŠ¶æ€é‡Œå°†ä¼šå‡ºç°ä¸€ä¸ªä»»åŠ¡ã€‚

![Untitled](%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%80%85%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%20Centos%20Docker%20Nginx%20Node%20Jenkins%20%E6%93%8D%E4%BD%9C%2088481b53f8d0492ca62434a0a42a2122/Untitled%205.png)

[data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

### **å®ç°é‚®ä»¶æé†’-todo**

### **æ‰¹é‡åˆ é™¤æ„å»ºå†å²**

è¿›å…¥`ç³»ç»Ÿé…ç½®`->`è„šæœ¬å‘½ä»¤è¿è¡Œ`

![Untitled](%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%80%85%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%20Centos%20Docker%20Nginx%20Node%20Jenkins%20%E6%93%8D%E4%BD%9C%2088481b53f8d0492ca62434a0a42a2122/Untitled%206.png)

[data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

è¾“å…¥è„šæœ¬

```
#Â "test"æ˜¯é¡¹ç›®åç§°ï¼Œ100æ˜¯æŒ‡ï¼ˆ0~Â·100ï¼‰å…¨åˆ é™¤ï¼Œå°±æ˜¯æ„å»ºå†å²å‰é¢çš„ID
defÂ jobNameÂ =Â "test"

defÂ maxNumberÂ =Â 100

Jenkins.instance.getItemByFullName(jobName).builds.findAllÂ {it.numberÂ <=Â maxNumber}.eachÂ {Â it.delete()Â }

```

ç‚¹å‡»`è¿è¡Œ`

---

## **æœ€å**

åœ¨æ—¥å¸¸å·¥ä½œä¸­ä½ è¿˜ä½¿ç”¨å“ªäº›`Centosé…ç½®`å‘¢ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹çš„ä½ çš„è§è§£ï¼

è§‰å¾—æœ‰æ”¶è·çš„æœ‹å‹æ¬¢è¿ç‚¹èµï¼Œå…³æ³¨ä¸€æ³¢!

### **å‚è€ƒèµ„æ–™**

[1]

ä»åŸç†åˆ°å®æˆ˜ï¼Œå½»åº•ææ‡‚ Nginxï¼:*https://zhuanlan.zhihu.com/p/101961241*

[2]

NVM å®˜ç½‘:*https://github.com/nvm-sh/nvm#install--update-script*

[3]

Node.js å®˜ç½‘:*http://nodejs.cn/download/*

[4]

æ˜¾ç¤ºæœ¬åœ°é•œåƒåˆ—è¡¨:*https://www.runoob.com/docker/docker-images-command.html*

[5]

åˆ é™¤æœ¬åœ°ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ:*https://www.runoob.com/docker/docker-rmi-command.html*

[6]

å®¹å™¨çš„å¯åŠ¨/å…³é—­/é‡å¯:*https://www.runoob.com/docker/docker-start-stop-restart-command.html*

[7]

åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨:*https://www.runoob.com/docker/docker-rm-command.html*

[8]

é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡:*https://cr.console.aliyun.com/cn-beijing/instances/mirrors*

[9]

Nginx å®¹å™¨æ•™ç¨‹:*https://www.ruanyifeng.com/blog/2018/02/nginx-docker.html*

[10]

Debian é•œåƒä½¿ç”¨å¸®åŠ©:*https://mirrors.tuna.tsinghua.edu.cn/help/debian/*

[11]

ä» 0 åˆ° 1 å®ç°ä¸€å¥— CI/CD æµç¨‹:Â *https://juejin.cn/book/6897616008173846543*

[12]

å®˜æ–¹æ•™ç¨‹:*https://wiki.jenkins.io/display/JENKINS//Installing+Jenkins+on+Red+Hat+distributions#space-menu-link-content*

[13]

æ¸…åå¤§å­¦é•œåƒç«™:*https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/*

[14]

UmiJS:*https://gitee.com/nsuedu/umi-test*

[15]

è¿™é‡Œ:*https://www.runoob.com/docker/docker-dockerfile.html*

[16]

ä»£ç åº“:*https://gitee.com/nsuedu/umi-test*

> ä½œè€…ï¼šæœ›é“åŒå­¦
> 
> 
> https://juejin.cn/post/6951684431597797389
>